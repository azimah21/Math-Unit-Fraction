<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --ring:#94a3b8; --primary:#2563eb; --primary-weak:#dbeafe;
    --ok:#16a34a; --warn:#dc2626; --soft:#e2e8f0;
    --chip:#eef2ff; --chip-ink:#3730a3;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,Segoe UI,Roboto,Arial;}
  .wrap{max-width:1080px;margin:24px auto;padding:0 16px;}
  h1{font-size:clamp(24px,4vw,40px);margin:0 0 6px;}
  .subtitle{color:var(--muted);margin:0 0 18px;}
  .row{display:grid;grid-template-columns:1fr 360px;gap:16px}
  .card{background:var(--card);border:1px solid var(--soft);border-radius:14px;box-shadow:0 2px 8px rgba(15,23,42,.04)}
  .card .pad{padding:16px 18px}
  .meta{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
  .pill{background:var(--chip);color:var(--chip-ink);padding:6px 10px;border-radius:999px;font-weight:600;font-size:14px}
  .title{font-weight:800;font-size:20px;margin:0 0 10px}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  button.denom{padding:12px 6px;border-radius:12px;border:1px solid var(--soft);background:#fff;font-weight:700;cursor:pointer}
  button.denom[aria-pressed="true"]{outline:3px solid var(--primary);background:var(--primary-weak)}
  .actions{display:flex;gap:12px;align-items:center;margin-top:12px}
  .btn{border:1px solid var(--ring);background:#fff;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
  .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .eq{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#f8fafc;border:1px solid var(--soft);border-radius:10px;padding:10px 12px;margin:8px 0 6px;white-space:nowrap;overflow:auto}
  .barWrap{margin-top:8px}
  .barLabel{font-weight:700;margin:6px 0 4px}
  .bar{height:16px;border-radius:8px;border:1px solid var(--soft);display:flex;overflow:hidden;background:#fff}
  .seg{flex:1;border-right:1px solid var(--soft)}
  .seg:last-child{border-right:none}
  .shade{background:rgba(37,99,235,.35)}
  .coach h3{margin:0 0 8px}
  .ok{color:var(--ok);font-weight:800}
  .bad{color:var(--warn);font-weight:800}
  .note{font-size:13px;color:var(--muted);margin-top:6px}
  .compare h3{margin:0 0 6px}
  .attempts{font-size:14px;color:var(--muted)}
  @media (max-width:900px){ .row{grid-template-columns:1fr;} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <p class="subtitle">Let‚Äôs make this fraction: <b id="headTarget">1/?</b>. Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</p>

    <div class="meta">
      <div class="pill">Question <span id="qNum">1</span>/10</div>
      <div class="pill">Score <span id="score">0</span></div>
      <div class="pill">Target <span id="targetMeta">1/?</span></div>
      <div class="pill attempts">Attempts: <span id="att">0</span>/5</div>
    </div>

    <div class="row">
      <!-- LEFT: Game -->
      <div class="card">
        <div class="pad">
          <div class="title">Target</div>
          <p class="muted" id="targetCopy">Make <b>1/?</b> using two unit fractions.</p>

          <!-- Live equation -->
          <div class="eq" id="eq">1/? = 1/_ + 1/_</div>
          <div class="note">Pick two denominators below. The equation will update.</div>

          <!-- Stacked visuals -->
          <div class="barGroup">
            <div class="barWrap">
              <div class="barLabel">Visual of the <u>target</u></div>
              <div class="bar" id="barTarget"></div>
              <div class="note" id="barTargetNote"></div>
            </div>
            <div class="barWrap">
              <div class="barLabel">Visual of your <u>1st pick</u></div>
              <div class="bar" id="barA"></div>
              <div class="note" id="barANote"></div>
            </div>
            <div class="barWrap">
              <div class="barLabel">Visual of your <u>2nd pick</u></div>
              <div class="bar" id="barB"></div>
              <div class="note" id="barBNote"></div>
            </div>
          </div>

          <!-- Denominator choices -->
          <div class="title" style="margin-top:16px;">Pick exactly two denominators</div>
          <div class="grid" id="choices"></div>

          <div class="actions">
            <button class="btn primary" id="checkBtn">Check Answer</button>
            <button class="btn" id="resetBtn">Reset Selection</button>
            <button class="btn" id="nextBtn" disabled>Next ‚ñ∏</button>
            <span class="attempts">You must try this question at least 5 times.</span>
          </div>

          <!-- Compare panel -->
          <div class="card" style="margin-top:16px">
            <div class="pad compare">
              <h3>Compare: <b>Your sum</b> vs <b>Target</b></h3>
              <p class="muted">We use a common split so both bars can be compared fairly.</p>
              <div class="barWrap">
                <div class="barLabel">Your sum <span id="sumLabel">(1/a + 1/b)</span> <span id="sumIcon"></span></div>
                <div class="bar" id="barSum"></div>
                <div class="note" id="sumNote"></div>
              </div>
              <div class="barWrap" style="margin-top:10px">
                <div class="barLabel">Target <span id="tgtLabel">(1/n)</span></div>
                <div class="bar" id="barTgtCmp"></div>
                <div class="note" id="tgtNote"></div>
              </div>
              <div class="note" id="resultMsg"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Coach -->
      <div class="card coach">
        <div class="pad">
          <h3>Think-Aloud Coach</h3>
          <div id="coachText" class="muted">
            Let‚Äôs start! Is the target a small amount or a big amount? Will our denominators be bigger or smaller?
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="pad">
        <div class="title">How it works</div>
        <p>We want <b>1/a + 1/b = 1/n</b>. That‚Äôs true exactly when <b>n(a+b) = ab</b>. Each round the game chooses a target denominator <b>n</b>, makes sure there‚Äôs a valid pair <b>(a,b)</b> within 1‚Äì20, mixes in good distractors, and asks you to find the correct pair.</p>
        <p class="muted">Difficulty adapts to you: quick success makes it harder; a few struggles keep it similar; more struggles make it easier.</p>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- helpers ----------
  const el = id => document.getElementById(id);
  const rand = (arr)=>arr[Math.floor(Math.random()*arr.length)];
  const range = (a,b)=>Array.from({length:b-a+1},(_,i)=>a+i);
  const gcd=(a,b)=>b?gcd(b,a%b):a;
  const lcm=(a,b)=>a/gcd(a,b)*b;

  function buildBar(node, parts, shaded){
    node.innerHTML="";
    const maxSeg = 60;
    let k = 1;
    if(parts>maxSeg){ k = Math.ceil(parts/maxSeg); }
    const segs = Math.ceil(parts/k);
    const shadedSegs = Math.round(shaded/k);
    for(let i=0;i<segs;i++){
      const d=document.createElement('div');
      d.className="seg"+(i<shadedSegs?" shade":"");
      node.appendChild(d);
    }
  }

  function divisors(n){
    const ds=[];
    for(let i=1;i*i<=n;i++){
      if(n%i===0){ ds.push(i); if(i*i!==n) ds.push(n/i); }
    }
    return ds.sort((a,b)=>a-b);
  }

  // Find a,b (<=20) satisfying (a-n)(b-n)=n^2, return first that fits.
  function findPairWithin20(n){
    const ds = divisors(n*n);
    for(const k of ds){
      const a = n + k;
      const b = n + (n*n)/k;
      if(a>=1 && b>=1 && Number.isInteger(b) && a<=20 && b<=20) return [a,b];
    }
    return null;
  }

  // Choose n (difficulty level) that has a valid pair in 1..20
  function chooseTarget(level){
    // levels map to different bands of n; we‚Äôll search until we find a valid pair
    const bands = {
      1:[10,11,12,14,15,16,18,20],
      2:[8,9,10,12,14,15,16],
      3:[6,7,8,9,10,12],
    };
    const pool = bands[level] || bands[2];
    const shuffled = pool.slice().sort(()=>Math.random()-0.5);
    for(const n of shuffled){
      const pair = findPairWithin20(n);
      if(pair) return {n,pair};
    }
    // fallback ‚Äî relax to any n 6..20
    for(const n of range(6,20)){
      const pair = findPairWithin20(n);
      if(pair) return {n,pair};
    }
    // absolute fallback
    return {n:10,pair:[20,20]};
  }

  function makeChoices(a,b){
    const base = new Set([a,b]);
    // add distractors from 1..20
    while(base.size<8){
      base.add(1+Math.floor(Math.random()*20));
    }
    return Array.from(base).sort((x,y)=>x-y);
  }

  // ---------- game state ----------
  let q=1, score=0, level=2;
  let n=10, correctA=0, correctB=0;
  let pickA=null, pickB=null;
  let attempts=0, wrongAttempts=0, solved=false;

  // ---------- renderers ----------
  function renderMeta(){
    el("qNum").textContent=q;
    el("score").textContent=score;
    el("targetMeta").textContent=`1/${n}`;
    el("headTarget").textContent=`1/${n}`;
    el("targetCopy").innerHTML=`Make <b>1/${n}</b> using two unit fractions.`;
    el("att").textContent=attempts;
    el("eq").textContent=`1/${n} = 1/${pickA??"_"} + 1/${pickB??"_"}`;
    // target bar
    const T = Math.min(60, n); // render cap
    buildBar(el("barTarget"), T, Math.ceil(T/n));
    el("barTargetNote").textContent = `Target 1/${n}. The bar is split into ${n} equal parts; one part is shaded.`;
    // picks
    if(pickA){
      buildBar(el("barA"), Math.min(60,pickA), 1);
      el("barANote").textContent = `You chose 1/${pickA}. The bar is split into ${pickA} equal parts; one part is shaded.`;
    } else { el("barA").innerHTML=""; el("barANote").textContent=""; }
    if(pickB){
      buildBar(el("barB"), Math.min(60,pickB), 1);
      el("barBNote").textContent = `You chose 1/${pickB}. The bar is split into ${pickB} equal parts; one part is shaded.`;
    } else { el("barB").innerHTML=""; el("barBNote").textContent=""; }
    // compare bars (only when both picks exist)
    compareBars();
  }

  function compareBars(){
    const sumIcon = el("sumIcon");
    const msg = el("resultMsg");
    if(!(pickA && pickB)){
      el("barSum").innerHTML=""; el("sumNote").textContent="";
      el("barTgtCmp").innerHTML=""; el("tgtNote").textContent="";
      el("sumLabel").textContent="(1/a + 1/b)";
      el("tgtLabel").textContent=`(1/${n})`;
      sumIcon.textContent=""; msg.textContent="";
      return;
    }
    const L = Math.min(120, lcm(lcm(pickA,pickB), n)); // common split
    const shadedSum = Math.round(L/pickA + L/pickB);
    const shadedTgt = Math.round(L/n);
    buildBar(el("barSum"), L, shadedSum);
    buildBar(el("barTgtCmp"), L, shadedTgt);
    el("sumLabel").textContent=`(1/${pickA} + 1/${pickB})`;
    el("tgtLabel").textContent=`(1/${n})`;
    el("sumNote").textContent=`Common split: ${L}. Your shaded pieces: ${shadedSum}/${L}.`;
    el("tgtNote").textContent=`Target shaded pieces: ${shadedTgt}/${L}.`;

    const correct = (shadedSum === shadedTgt);
    if(correct){
      sumIcon.innerHTML = ` <span class="ok">‚úÖ Awesome! Right on target!</span>`;
      msg.textContent = "";
    }else{
      sumIcon.innerHTML = ` <span class="bad">‚ùå Oops! Try again, I know you can do it!</span>`;
      msg.textContent = "";
    }
  }

  function renderChoices(list){
    const box = el("choices"); box.innerHTML="";
    list.forEach(v=>{
      const b=document.createElement("button");
      b.className="denom"; b.textContent=v;
      b.dataset.value=v;
      b.addEventListener("click", ()=>{
        if(b.getAttribute("aria-pressed")==="true"){ // unselect
          b.setAttribute("aria-pressed","false");
          if(pickA==v){ pickA=null; }
          else if(pickB==v){ pickB=null; }
        }else{
          // select logic: allow up to 2 picks
          if(pickA && pickB){ return; }
          b.setAttribute("aria-pressed","true");
          if(!pickA) pickA=v; else if(!pickB && v!==pickA) pickB=v;
          // first-pick coaching visual comes via renderMeta
          if(pickA && !pickB){
            coach.onFirstPick(pickA, n);
          }
        }
        renderMeta();
      });
      b.setAttribute("aria-pressed","false");
      box.appendChild(b);
    });
  }

  // ---------- coaching ----------
  const coach = (()=> {
    function set(html){ el("coachText").innerHTML = html; }
    return {
      start(ntarget){
        set(`<ol style="margin:0 0 6px 18px">
          <li>Our target is <b>1/${ntarget}</b>. Is that a small amount or a big amount?</li>
          <li>Unit fractions get <b>smaller</b> when denominators get <b>bigger</b>.</li>
          <li>Quick estimate: will both denominators likely be bigger than ${ntarget} or around it?</li>
        </ol>
        When you're ready: <b>Pick one denominator you think might work. Why that one?</b>`);
      },
      onFirstPick(a, ntarget){
        set(`<div><b>Nice pick.</b> How will you find the second number?</div>
        <ul>
          <li>Try same-family numbers first (near your first pick or linked to the target).</li>
          <li>If the sum is <b>too big</b>, your numbers were <b>too small</b>. If it‚Äôs <b>too small</b>, your numbers were <b>too big</b>.</li>
        </ul>
        <div class="note">You chose <b>1/${a}</b>. The bar shows <b>1/a</b> as one shaded piece.</div>`);
      },
      onCheck(msgHtml){ set(msgHtml); }
    }
  })();

  // ---------- flow ----------
  function newQuestion(adjust=0){
    // adjust difficulty
    level = Math.max(1, Math.min(3, level + adjust));
    const pick = chooseTarget(level);
    n = pick.n;
    [correctA, correctB] = pick.pair.sort((x,y)=>x-y);

    // choices list
    renderChoices(makeChoices(correctA, correctB));

    // reset state
    pickA = pickB = null;
    solved=false; attempts=0; wrongAttempts=0;
    el("att").textContent=attempts;
    el("nextBtn").disabled = true;
    el("sumIcon").textContent=""; el("resultMsg").textContent="";
    el("score").textContent=score;
    el("eq").textContent=`1/${n} = 1/_ + 1/_`;
    el("headTarget").textContent=`1/${n}`;
    el("targetMeta").textContent=`1/${n}`;
    el("targetCopy").innerHTML=`Make <b>1/${n}</b> using two unit fractions.`;
    coach.start(n);
    renderMeta();
  }

  el("resetBtn").addEventListener("click", ()=>{
    // clear selections
    pickA = pickB = null;
    document.querySelectorAll("button.denom[aria-pressed='true']").forEach(b=>b.setAttribute("aria-pressed","false"));
    renderMeta();
  });

  el("checkBtn").addEventListener("click", ()=>{
    if(!(pickA && pickB)) {
      coach.onCheck(`<div>Please pick <b>two</b> denominators first.</div>`);
      return;
    }
    attempts++; el("att").textContent=attempts;

    const sum = 1/pickA + 1/pickB;
    const target = 1/n;
    const correct = Math.abs(sum - target) < 1e-12;

    if(correct && !solved){
      solved=true; score++; el("score").textContent=score;
    }
    // coach message
    if(correct){
      coach.onCheck(`<div class="ok">‚úÖ Our sum equals 1/${n}.</div>
        <div>What <b>pattern</b> did you notice about denominators that worked? How could you <b>guess faster</b> next time?</div>`);
    }else if(sum > target){
      wrongAttempts++;
      coach.onCheck(`<div class="bad">Our sum is <b>bigger</b> than 1/${n}.</div>
        <div>Next try: use <b>bigger denominators</b> (that makes each unit fraction smaller).</div>`);
    }else{
      wrongAttempts++;
      coach.onCheck(`<div class="bad">Our sum is <b>smaller</b> than 1/${n}.</div>
        <div>Next try: use <b>smaller denominators</b> (that makes each unit fraction bigger).</div>`);
    }

    // update compare bars & equation
    compareBars();
    el("eq").textContent=`1/${n} = 1/${pickA} + 1/${pickB}`;

    // enable Next only after 5 tries AND at least one correct
    const allowNext = attempts>=5 && solved;
    el("nextBtn").disabled = !allowNext;

    // adaptive preview message when they *have* solved it
    if(solved){
      const r = wrongAttempts;
      if(r===0){
        el("resultMsg").innerHTML = `üéØ <b>You nailed it!</b> Let's give you something more challenging!`;
      }else if(r===3){
        el("resultMsg").innerHTML = `üëç <b>You're on track!</b> Keep going!`;
      }else if(r>3){
        el("resultMsg").innerHTML = `üí™ <b>Hang in there!</b> We'll help you out!`;
      }else{
        el("resultMsg").innerHTML = ``;
      }
    }
  });

  el("nextBtn").addEventListener("click", ()=>{
    // decide adjustment by rule
    let adjust=0;
    if(solved){
      if(wrongAttempts===0) adjust=+1;
      else if(wrongAttempts===3) adjust=0;
      else if(wrongAttempts>3) adjust=-1;
      else adjust=0;
    }
    q++; newQuestion(adjust);
  });

  // kick off
  newQuestion(0);
})();
</script>
</body>
</html>
