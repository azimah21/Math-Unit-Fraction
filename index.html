<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --accent:#2563eb; --accent-2:#22c55e; --warn:#ef4444; --soft:#e2e8f0;
    --glow: 0 0 0 3px rgba(37,99,235,.25);
  }
  *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--ink)}
  header{padding:20px 16px 6px;max-width:980px;margin:auto}
  h1{margin:0 0 4px;font-size:32px}
  .sub{color:var(--muted)}
  main{max-width:980px;margin:8px auto 48px;padding:0 16px}
  .row{display:grid;grid-template-columns:1fr 340px;gap:16px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 10px rgba(2,6,23,.06);padding:16px}
  .title{font-weight:700;margin:0 0 10px}
  .pill{display:inline-block;background:#edf2ff;border:1px solid #c7d2fe;border-radius:999px;padding:6px 10px;margin:0 8px 8px 0;font-size:14px}
  .meta{display:flex;gap:8px;margin:6px 0 14px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{border:0;border-radius:12px;padding:12px 14px;font-weight:700;background:var(--accent);color:white;cursor:pointer}
  .btn.secondary{background:#e5e7eb;color:#111827}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .choice-btn{
    background:#e7eefb;border:2px solid transparent;border-radius:12px;padding:12px 0;
    text-align:center;font-weight:800;cursor:pointer;transition:.15s;
  }
  .choice-btn:hover{filter:brightness(0.98)}
  .choice-btn.selected{border-color:var(--accent);background:#eef5ff;box-shadow:var(--glow)}
  .choice-btn.disabled{opacity:.45;cursor:not-allowed}
  .eq{font-family:ui-monospace,Consolas,Menlo,monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px}
  .muted{color:var(--muted);font-size:14px}
  .bar{height:16px;border:1px solid #e2e8f0;border-radius:8px;display:flex;overflow:hidden;background:white}
  .bar .seg{flex:1;border-right:1px solid #eef2f7}
  .note{font-size:13px;color:var(--muted);margin-top:6px}
  .ok{color:var(--accent-2);font-weight:700}
  .warn{color:var(--warn);font-weight:700}
  .cmpRow{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;margin:10px 0}
  .emoji{font-size:18px;margin-right:6px}
  .center{display:flex;justify-content:center;align-items:center}
  /* end screen effects (simple CSS ‚Äúsparkles/confetti/fireworks‚Äù placeholders) */
  .effects{height:120px; position:relative; margin:6px 0 14px}
  .sparkle,.confetti,.firework{
    position:absolute; width:6px; height:6px; border-radius:50%;
    animation: float 2.4s linear infinite;
  }
  @keyframes float { 0%{transform:translateY(0)} 100%{transform:translateY(-90px); opacity:0} }
  .sparkle{background:#ffd54f; left:10%}
  .confetti{background:#60a5fa; left:50%}
  .firework{background:#f87171; left:80%}
  #summary{display:none}
</style>
</head>
<body>
<header>
  <h1>Unit Fraction Builder</h1>
  <div class="sub">Let‚Äôs make this fraction: <b id="headlineTarget">1/8</b>. Pick two different unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</div>
</header>

<main>
  <div class="meta">
    <span class="pill">Question <span id="qNo">1</span>/10</span>
    <span class="pill">Score <span id="score">0</span></span>
    <span class="pill">Target <span id="pillTarget">1/8</span></span>
    <span class="pill">Attempts <span id="attempts">0</span>/5</span>
  </div>

  <div id="gameArea" class="row">
    <!-- LEFT -->
    <section class="card">
      <h2 class="title">Target</h2>
      <div class="muted" id="targetSentence">Make <b>1/8</b> using two different unit fractions.</div>

      <!-- Live equation -->
      <div class="card" style="margin-top:12px">
        <div class="eq" id="liveEq">1/8 = 1/‚Äì + 1/‚Äì</div>
        <div class="muted">Choose two numbers below. The equation updates as you pick.</div>
      </div>

      <!-- Stacked visuals: target, pick1, pick2 -->
      <div class="card" style="margin-top:12px">
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="barTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Your 1st pick</b></div>
          <div id="barPick1" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Your 2nd pick</b></div>
          <div id="barPick2" class="bar"></div></div>
      </div>

      <!-- Compare box -->
      <div id="compareCard" class="card" style="margin-top:12px">
        <h3 class="title" style="margin-bottom:6px">Compare: Your sum vs Target</h3>
        <div class="muted">We shade pieces using a common split to compare fairly.</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="cmpTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Your sum</b></div>
          <div id="cmpSum" class="bar"></div></div>
        <div class="muted" id="cmpText">Pick two numbers to compare.</div>
        <div id="cmpVerdict" class="muted" style="margin-top:6px"></div>
      </div>

      <!-- Reveal after 5 attempts if still incorrect -->
      <div id="revealCard" class="card" style="margin-top:12px; display:none; border:1px dashed #cbd5e1">
        <h3 class="title">Here‚Äôs one correct way</h3>
        <div class="eq" id="revealEq">1/8 = 1/5 + 1/20</div>
        <div class="muted" style="margin-top:6px">Watch how the two unit fractions add up (two colours):</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="revTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Correct sum</b></div>
          <div id="revSum" class="bar"></div></div>
      </div>

      <!-- Choices -->
      <h3 class="title" style="margin-top:14px">Pick exactly two denominators</h3>
      <div id="choicesGrid" class="grid" style="margin-bottom:12px"></div>

      <div style="display:flex;gap:10px">
        <button id="checkBtn" class="btn" disabled>Check Answer</button>
        <button id="resetBtn" class="btn secondary">Reset Selection</button>
        <button id="nextBtn" class="btn secondary" disabled>Next ‚ñ∏</button>
      </div>
      <div id="feedback" class="muted" style="margin-top:8px">Pick two denominators, then press Check.</div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <h3 class="title">Think-Aloud Coach</h3>
      <div id="coachText" class="muted">
        Let‚Äôs make <b id="coachTarget">1/8</b>.<br/>
        Tips:
        <ul style="margin-top:6px">
          <li>Unit fractions get smaller when denominators get bigger.</li>
          <li>Try ‚Äúsame-family‚Äù numbers first (linked to the target‚Äôs denominator), then adjust.</li>
          <li>If your sum is too big ‚Üí pick bigger denominators. Too small ‚Üí pick smaller denominators.</li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- SUMMARY -->
  <section id="summary" class="card center" style="max-width:720px;margin:16px auto 0; text-align:center;">
    <div>
      <div class="effects">
        <div class="sparkle" style="left:12%"></div>
        <div class="confetti" style="left:48%"></div>
        <div class="firework" style="left:78%"></div>
      </div>
      <h2 id="finalHeadline" class="title">Well done!</h2>
      <p id="finalScore" class="muted">You scored 8/10.</p>
      <button id="playAgainBtn" class="btn" style="margin-top:10px">Play again</button>
    </div>
  </section>
</main>

<script>
(() => {
  // ---------- DOM
  const choicesGrid = document.getElementById('choicesGrid');
  const targetFractionEl = document.getElementById('headlineTarget');
  const pillTargetEl = document.getElementById('pillTarget');
  const coachTargetEl = document.getElementById('coachTarget');
  const barTarget = document.getElementById('barTarget');
  const barPick1 = document.getElementById('barPick1');
  const barPick2 = document.getElementById('barPick2');
  const cmpTarget = document.getElementById('cmpTarget');
  const cmpSum = document.getElementById('cmpSum');
  const cmpText = document.getElementById('cmpText');
  const cmpVerdict = document.getElementById('cmpVerdict');
  const liveEq = document.getElementById('liveEq');
  const attemptsEl = document.getElementById('attempts');
  const qNoEl = document.getElementById('qNo');
  const scoreEl = document.getElementById('score');
  const feedback = document.getElementById('feedback');
  const checkBtn = document.getElementById('checkBtn');
  const nextBtn = document.getElementById('nextBtn');
  const resetBtn = document.getElementById('resetBtn');
  const revealCard = document.getElementById('revealCard');
  const revealEq = document.getElementById('revealEq');
  const revTarget = document.getElementById('revTarget');
  const revSum = document.getElementById('revSum');
  const gameArea = document.getElementById('gameArea');
  const summary = document.getElementById('summary');
  const finalHeadline = document.getElementById('finalHeadline');
  const finalScoreEl = document.getElementById('finalScore');
  const playAgainBtn = document.getElementById('playAgainBtn');

  // ---------- helpers
  const MIN_DEN = 2, MAX_DEN = 20;
  const TOTAL_Q = 10;

  const $ = (q) => document.querySelector(q);
  function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function lcm(a,b){ const g=(x,y)=>y?g(y,x%y):x; return a/g(a,b)*b; }
  function lcm3(a,b,c){ return lcm(lcm(a,b),c); }

  function drawUnitBar(el, parts, shadeLeft=1, shadeRight=0){
    el.innerHTML=""; if(!parts) return;
    const totalShade = Math.min(parts, shadeLeft+shadeRight);
    for(let i=0;i<parts;i++){
      const seg=document.createElement('div');
      seg.className='seg';
      if(i<shadeLeft){ seg.style.background='rgba(37,99,235,.35)'; }
      else if(i<totalShade){ seg.style.background='rgba(34,197,94,.35)'; }
      el.appendChild(seg);
    }
  }

  // ---------- state
  const state = {
    qIndex: 1,
    score: 0,
    target: 8,
    choices: [],
    selection: [],
    attempts: 0,
    wrongAttempts: 0,
    nextEnabled: false,
    pairSolution: [0,0],
    gameOver: false,
  };

  // all valid denominators for 1/n within [2..20], a‚â†b
  function validDenomsFor(n){
    const set = new Set();
    for(let a = n+1; a<=MAX_DEN; a++){
      const denom = a - n;
      const num = n * a;
      if(denom>0 && num % denom === 0){
        const b = num/denom;
        if(Number.isInteger(b) && b>=MIN_DEN && b<=MAX_DEN && a!==b){
          set.add(a); set.add(b);
        }
      }
    }
    return Array.from(set).sort((x,y)=>x-y);
  }
  function allPairsFor(n){
    const pairs=[];
    for(let a = n+1; a<=MAX_DEN; a++){
      const denom = a-n, num = n*a;
      if(denom>0 && num%denom===0){
        const b = num/denom;
        if(Number.isInteger(b) && b>=MIN_DEN && b<=MAX_DEN && a!==b){
          // de-dup unordered pairs
          if(!pairs.some(p => (p[0]===b && p[1]===a) || (p[0]===a && p[1]===b))){
            pairs.push([a,b]);
          }
        }
      }
    }
    return pairs;
  }

  // pick a target n with at least one valid pair (and not requiring identical denoms)
  const TARGET_POOL = [6,7,8,9,10,11,12,13,14,15,16,18,20];
  function newTarget(){
    // try up to 50 times to find n with >=1 pair
    for(let t=0;t<50;t++){
      const n = TARGET_POOL[randInt(0, TARGET_POOL.length-1)];
      if(allPairsFor(n).length>0) return n;
    }
    return 8;
  }

  function buildChoices(n){
    const pairs = allPairsFor(n);
    const chosenPair = pairs[randInt(0,pairs.length-1)]; // one correct pair
    const [a,b] = chosenPair;
    // candidate pool for distractors = all valid denominators for this n, minus a,b
    const pool = validDenomsFor(n).filter(x => x!==a && x!==b);
    const distractors = [];
    shuffle(pool);
    for(const d of pool){
      if(distractors.length>=6) break;
      distractors.push(d);
    }
    // if not enough, fill from 2..20 excluding a,b and current distractors
    for(let d=MIN_DEN; distractors.length<6 && d<=MAX_DEN; d++){
      if(d!==a && d!==b && !distractors.includes(d)) distractors.push(d);
    }
    const choices = shuffle([a,b,...distractors].slice(0,8));
    return { choices, solution:[a,b] };
  }

  function isCorrect(n,a,b){ return a*b === n*(a+b); }

  function resetSelectionUI(){
    state.selection = [];
    document.querySelectorAll('.choice-btn').forEach(btn=>btn.classList.remove('selected','disabled'));
    liveEq.textContent = `1/${state.target} = 1/‚Äì + 1/‚Äì`;
    barPick1.innerHTML = ""; barPick2.innerHTML="";
    cmpTarget.innerHTML=""; cmpSum.innerHTML=""; cmpText.textContent="Pick two numbers to compare."; cmpVerdict.innerHTML="";
  }

  function renderQuestion(){
    targetFractionEl.textContent = `1/${state.target}`;
    pillTargetEl.textContent = `1/${state.target}`;
    coachTargetEl.textContent = `1/${state.target}`;
    document.getElementById('targetSentence').innerHTML = `Make <b>1/${state.target}</b> using two different unit fractions.`;
    document.getElementById('qNo').textContent = state.qIndex;
    attemptsEl.textContent = state.attempts;
    scoreEl.textContent = state.score;
    feedback.textContent = 'Pick two denominators, then press Check.';
    revealCard.style.display = 'none';
    nextBtn.disabled = !state.nextEnabled;
    nextBtn.textContent = (state.qIndex === TOTAL_Q ? 'Finish ‚ñ∏' : 'Next ‚ñ∏');

    // draw target bar
    drawUnitBar(barTarget, state.target, 1, 0);

    // render choices
    choicesGrid.innerHTML="";
    state.choices.forEach(den=>{
      const btn=document.createElement('button');
      btn.className='choice-btn';
      btn.textContent=den;
      btn.addEventListener('click', ()=>{
        // toggle select; keep at most 2, distinct
        if(btn.classList.contains('disabled')) return;
        const val = den;
        const idx = state.selection.indexOf(val);
        if(idx>=0){
          state.selection.splice(idx,1);
          btn.classList.remove('selected');
        }else{
          if(state.selection.length===2) return;
          if(state.selection.length===1 && state.selection[0]===val) return; // prevent duplicate a=b
          state.selection.push(val);
          btn.classList.add('selected');
        }
        // update bars + equation + compare
        const a = state.selection[0] || null;
        const b = state.selection[1] || null;
        liveEq.textContent = `1/${state.target} = 1/${a??'‚Äì'} + 1/${b??'‚Äì'}`;
        barPick1.innerHTML=""; barPick2.innerHTML="";
        if(a) drawUnitBar(barPick1, a, 1, 0);
        if(b) drawUnitBar(barPick2, b, 1, 0);
        if(a && b){
          const L = lcm3(a,b,state.target);
          drawUnitBar(cmpTarget, L, L/state.target, 0);
          drawUnitBar(cmpSum, L, L/a, L/b);
          cmpText.textContent = `Common split: ${L}. Your shaded: ${(L/a)+(L/b)}/${L}. Target shaded: ${L/state.target}/${L}.`;
        }else{
          cmpTarget.innerHTML=""; cmpSum.innerHTML=""; cmpText.textContent="Pick two numbers to compare."; cmpVerdict.innerHTML="";
        }
        checkBtn.disabled = !(a && b);
      });
      choicesGrid.appendChild(btn);
    });
    checkBtn.disabled = true;
  }

  function revealOneCorrect(){
    const [a,b] = state.pairSolution;
    revealEq.textContent = `1/${state.target} = 1/${a} + 1/${b}`;
    const L = lcm(a,b);
    drawUnitBar(revTarget, L, L/state.target, 0);
    drawUnitBar(revSum, L, L/a, L/b);
    revealCard.style.display = 'block';
  }

  function checkAnswer(){
    if(state.selection.length!==2) return;
    const [a,b] = state.selection;
    state.attempts++; attemptsEl.textContent = state.attempts;

    const correct = isCorrect(state.target, a, b);
    const L = lcm3(a,b,state.target);
    drawUnitBar(cmpTarget, L, L/state.target, 0);
    drawUnitBar(cmpSum, L, L/a, L/b);

    if(correct){
      state.score++; scoreEl.textContent = state.score;
      cmpVerdict.innerHTML = `<span class="emoji">üéØ</span><b>Awesome! Right on target!</b>`;
      feedback.innerHTML = `<span class="ok">Great job!</span> You may go next.`;
      state.nextEnabled = true;
      nextBtn.disabled = false;
    }else{
      state.wrongAttempts++;
      const bigger = (1/a + 1/b) > (1/state.target);
      cmpVerdict.innerHTML = `<span class="emoji">ü§î</span><b>Oops! Try again, I know you can do it!</b>
        <div class="note">Our sum is <b>${bigger?'bigger':'smaller'}</b> than 1/${state.target}. Try ${bigger?'bigger':'smaller'} denominators.</div>`;
      feedback.textContent = `Attempts: ${state.attempts}/5`;
      if(state.attempts>=5 && !state.nextEnabled){
        // unlock next + reveal one correct way
        revealOneCorrect();
        state.nextEnabled = true;
        nextBtn.disabled = false;
      }
    }
  }

  function startRound(){
    state.attempts = 0;
    state.wrongAttempts = 0;
    state.nextEnabled = false;
    state.selection = [];
    state.target = newTarget();
    const { choices, solution } = buildChoices(state.target);
    state.choices = choices;
    state.pairSolution = solution;
    renderQuestion();
  }

  function nextRound(){
    if(!state.nextEnabled) return;
    if(state.qIndex < TOTAL_Q){
      state.qIndex++;
      startRound();
    }else{
      // show summary ONCE at the end
      showSummary();
    }
  }

  function showSummary(){
    state.gameOver = true;
    gameArea.style.display = 'none';
    summary.style.display = 'block';
    const s = state.score;
    let head = 'Well done!';
    if(s<=4) head = 'Good try!';
    else if(s<=7) head = 'You did it!';
    finalHeadline.textContent = head;
    finalScoreEl.textContent = `You scored ${s}/${TOTAL_Q}.`;
  }

  function playAgain(){
    // reset everything
    state.qIndex = 1;
    state.score = 0;
    state.gameOver = false;
    gameArea.style.display = 'grid';
    summary.style.display = 'none';
    startRound();
  }

  resetBtn.addEventListener('click', ()=>{
    if(state.nextEnabled) return; // keep state if already finished question
    resetSelectionUI();
  });
  checkBtn.addEventListener('click', checkAnswer);
  nextBtn.addEventListener('click', nextRound);
  playAgainBtn.addEventListener('click', playAgain);

  // boot
  startRound();
})();
</script>
</body>
</html>

