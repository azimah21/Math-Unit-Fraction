<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --accent:#2563eb; --accent-2:#22c55e; --warn:#ef4444; --soft:#e2e8f0;
  }
  *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--ink)}
  header{padding:20px 16px 6px;max-width:980px;margin:auto}
  h1{margin:0 0 4px;font-size:34px}
  .sub{color:var(--muted)}
  main{max-width:980px;margin:8px auto;padding:0 16px 60px}
  .row{display:grid;grid-template-columns:1fr 340px;gap:16px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 10px rgba(2,6,23,.06);padding:16px}
  .title{font-weight:700;margin:0 0 10px}
  .pill{display:inline-block;background:#edf2ff;border:1px solid #c7d2fe;border-radius:999px;padding:6px 10px;margin:0 8px 8px 0;font-size:14px}
  .meta{display:flex;gap:8px;margin:6px 0 14px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{border:0;border-radius:12px;padding:12px 14px;font-weight:700;background:var(--accent);color:white;cursor:pointer}
  .btn.secondary{background:#e5e7eb;color:#111827}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .choice{background:#e7eefb;border:2px solid transparent;border-radius:12px;padding:14px 0;text-align:center;font-weight:700;cursor:pointer}
  .choice.selected{border-color:var(--accent);background:#eef5ff}
  .choice:disabled{opacity:.4;cursor:not-allowed}
  .eq{font-family:ui-monospace, Menlo, Consolas, "Liberation Mono", monospace;
      background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px}
  .muted{color:var(--muted);font-size:14px}
  .bar{height:16px;border:1px solid #e2e8f0;border-radius:8px;display:flex;overflow:hidden;background:white}
  .bar .seg{flex:1;border-right:1px solid #eef2f7}
  .note{font-size:13px;color:var(--muted);margin-top:6px}
  .ok{color:var(--accent-2);font-weight:700}
  .no{color:var(--warn);font-weight:700}
  .hidden{display:none}
  .coach h3{margin:0 0 8px}
  .right{display:flex;flex-direction:column;gap:12px}
  .cmpRow{display:grid;grid-template-columns:140px 1fr;gap:8px;align-items:center;margin:12px 0}
  .emoji{font-size:18px;margin-right:6px}
</style>
</head>
<body>
<header>
  <h1>Unit Fraction Builder</h1>
  <div class="sub">Let‚Äôs make this fraction: <b id="headlineTarget">1/8</b>. Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</div>
</header>

<main>
  <div class="meta">
    <span class="pill">Question <span id="qNo">1</span>/10</span>
    <span class="pill">Score <span id="score">0</span></span>
    <span class="pill">Target <span id="pillTarget">1/8</span></span>
    <span class="pill">Attempts <span id="attempts">0</span>/5</span>
  </div>

  <div class="row">
    <!-- LEFT -->
    <section class="card">
      <h2 class="title">Target</h2>
      <div class="muted" id="targetSentence">Make <b>1/8</b> using two unit fractions.</div>

      <!-- Live equation -->
      <div class="card" style="margin-top:12px">
        <div class="eq" id="liveEq">1/8 = 1/‚Äì + 1/‚Äì</div>
        <div class="muted">Pick two denominators below. The equation will update.</div>
      </div>

      <!-- Stacked visuals: target, pick1, pick2 -->
      <div class="card" style="margin-top:12px">
        <div class="cmpRow"><div class="muted"><b>Visual of the target</b></div>
          <div id="barTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Visual of your 1st pick</b></div>
          <div id="barPick1" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Visual of your 2nd pick</b></div>
          <div id="barPick2" class="bar"></div></div>
      </div>

      <!-- Compare box -->
      <div id="compareCard" class="card" style="margin-top:12px">
        <h3 class="title" style="margin-bottom:6px">Compare: Your sum vs Target</h3>
        <div class="muted">We shade pieces using a common split so both bars can be compared fairly.</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="cmpTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Your sum</b></div>
          <div id="cmpSum" class="bar"></div></div>
        <div class="muted" id="cmpText">Target shaded pieces: ‚Äì / ‚Äì.</div>
        <div id="cmpVerdict" class="muted" style="margin-top:6px"></div>
      </div>

      <!-- Reveal after 5 wrong -->
      <div id="revealCard" class="card hidden" style="margin-top:12px;border:1px dashed #cbd5e1">
        <h3 class="title">Here‚Äôs one correct way</h3>
        <div class="eq" id="revealEq">1/8 = 1/5 + 1/20</div>
        <div class="muted" style="margin-top:6px">Watch how the two unit fractions add up (two colours):</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="revTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Correct sum</b></div>
          <div id="revSum" class="bar"></div></div>
      </div>

      <!-- Choices -->
      <h3 class="title" style="margin-top:14px">Pick exactly two denominators</h3>
      <div id="choices" class="grid" style="margin-bottom:12px"></div>

      <div style="display:flex;gap:10px">
        <button id="checkBtn" class="btn" disabled>Check Answer</button>
        <button id="resetBtn" class="btn secondary">Reset Selection</button>
        <button id="nextBtn" class="btn secondary" disabled>Next ‚ñ∏</button>
      </div>
      <div class="muted" id="helper" style="margin-top:8px">Pick two denominators, then press Check.</div>
    </section>

    <!-- RIGHT -->
    <aside class="right">
      <section class="card coach">
        <h3 class="title">Think-Aloud Coach</h3>
        <div id="coachText" class="muted">
          Let‚Äôs make <b id="coachTarget">1/8</b>. Pick one number you think might work. Why that one?
          <div class="note" style="margin-top:6px">Tip: try ‚Äúsame-family‚Äù numbers first (linked to the target), then adjust.</div>
        </div>
      </section>
    </aside>
  </div>
</main>

<script>
/* ---------- helpers ---------- */
const $ = (id)=>document.getElementById(id);
function drawUnitBar(el, parts, shadeCountLeft=1, shadeCountRight=0){
  el.innerHTML = "";
  const totalShade = Math.min(parts, shadeCountLeft+shadeCountRight);
  for(let i=0;i<parts;i++){
    const d=document.createElement("div");
    d.className="seg";
    if(i<shadeCountLeft){ d.style.background="rgba(37,99,235,.35)"; }
    else if(i<totalShade){ d.style.background="rgba(34,197,94,.35)"; }
    el.appendChild(d);
  }
}
function lcm(a,b){ const g=(x,y)=>y?g(y,x%y):x; return a/g(a,b)*b; }

/* ---------- state ---------- */
let q=1, score=0;
let targetN = 8;
let pick1 = null, pick2 = null;
let attempts = 0, wrongAttempts = 0;
let allowNext = false;

/* ---------- target list limited to those with distinct-pair solutions in 1..20 ---------- */
const IN_RANGE = Array.from({length:19},(_,i)=>i+2); // 2..20
function hasDistinctPair(n){
  for(let a=n+1;a<=20;a++){
    const denom=a-n, num=n*a;
    if(denom>0 && num%denom===0){
      const b=num/denom;
      if(Number.isInteger(b) && b>=2 && b<=20 && a!==b) return true;
    }
  }
  return false;
}
const TARGET_POOL = Array.from({length:20},(_,i)=>i+2)
  .filter(n=>n>=3 && n<=20 && hasDistinctPair(n));

/* ---------- question generation ---------- */
function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function newQuestion(){
  targetN = randomFrom(TARGET_POOL);
  pick1 = pick2 = null;
  attempts = wrongAttempts = 0;
  allowNext = false;
  render();
  $("coachText").innerHTML =
   `Let‚Äôs make <b>1/${targetN}</b>. Pick one number you think might work. Why that one?
    <div class="note" style="margin-top:6px">If your sum is too big, your numbers were too small. If too small, your numbers were too big.</div>`;
}

function render(){
  $("headlineTarget").textContent = `1/${targetN}`;
  $("pillTarget").textContent = `1/${targetN}`;
  $("coachTarget").textContent = `1/${targetN}`;
  $("targetSentence").innerHTML = `Make <b>1/${targetN}</b> using two unit fractions.`;
  $("liveEq").textContent = `1/${targetN} = 1/${pick1 ?? "‚Äì"} + 1/${pick2 ?? "‚Äì"}`;
  $("attempts").textContent = attempts;

  drawUnitBar($("barTarget"), targetN, 1, 0);
  $("barPick1").innerHTML = ""; $("barPick2").innerHTML = "";
  if(pick1){ drawUnitBar($("barPick1"), pick1, 1, 0); }
  if(pick2){ drawUnitBar($("barPick2"), pick2, 1, 0); }

  // compare (only when both chosen)
  if(pick1 && pick2){
    const L = lcm(lcm(pick1,pick2), targetN);
    const tShade = L/targetN;
    const s1 = L/pick1, s2 = L/pick2;
    drawUnitBar($("cmpTarget"), L, tShade, 0);
    drawUnitBar($("cmpSum"), L, s1, s2);
    $("cmpText").textContent = `Common split: ${L}. Your shaded pieces: ${s1+s2}/${L}. Target shaded pieces: ${tShade}/${L}.`;
  }else{
    $("cmpTarget").innerHTML = ""; $("cmpSum").innerHTML = "";
    $("cmpText").textContent = "Pick two numbers to compare.";
    $("cmpVerdict").textContent = "";
  }

  // choices 1..20 (unique)
  const nums = Array.from({length:20},(_,i)=>i+1);
  const choices = $("choices"); choices.innerHTML = "";
  nums.forEach(n=>{
    const b=document.createElement("button");
    b.className="choice";
    b.textContent=n;
    if(n===pick1 || n===pick2) b.classList.add("selected");
    b.onclick=()=>{
      // prevent choosing the same denominator twice
      if(pick1===n && !pick2){ pick1 = null; } // toggle off first
      else if(!pick1){ pick1 = n; }
      else if(!pick2){
        if(n===pick1){
          $("helper").innerHTML = `<span class="no">Denominators must be different.</span>`;
          return;
        }
        pick2 = n;
      }else{
        // both filled: allow replacing the second
        if(n===pick1){
          $("helper").innerHTML = `<span class="no">Denominators must be different.</span>`;
          return;
        }
        pick2 = n;
      }
      $("checkBtn").disabled = !(pick1 && pick2);
      $("liveEq").textContent = `1/${targetN} = 1/${pick1 ?? "‚Äì"} + 1/${pick2 ?? "‚Äì"}`;
      render();
    };
    choices.appendChild(b);
  });

  $("checkBtn").disabled = !(pick1 && pick2);
  $("nextBtn").disabled = !allowNext;
  $("revealCard").classList.add("hidden");
}

/* ---------- correctness + attempts ---------- */
function isCorrect(n,a,b){
  if(a===b) return false; // enforce distinct denominators
  return a*b === n*(a+b);
}
function encouragement(){
  if(wrongAttempts===0 && attempts>0) return `<span class="ok">You nailed it!</span> Let‚Äôs give you something more challenging! üî∫`;
  if(wrongAttempts===3) return `<span class="ok">You're on track!</span> Keep going! ‚û°Ô∏è`;
  if(wrongAttempts>3) return `<span class="no">Hang in there!</span> We'll help you out. üîª`;
  return `Great effort ‚Äî adjust and try again!`;
}
function decideNextLevel(){ return "easy"; } // (kept simple here; pool already varied)

/* ---------- find a distinct correct pair for reveal (within 1..20) ---------- */
function correctPairFor(n){
  for(let a=n+1;a<=20;a++){
    const denom=a-n, num=n*a;
    if(denom>0 && num%denom===0){
      const b=num/denom;
      if(Number.isInteger(b) && b>=2 && b<=20 && a!==b) return [a,b];
    }
  }
  // fallback constructive (a!=b): choose k|n^2, force distinct by skipping k=n
  for(let k=1;k<=n*n;k++){
    if((n*n)%k===0){
      const a=n+k, b=n+(n*n)/k;
      if(a!==b) return [a,b];
    }
  }
  return [n+1, n*(n+1)]; // safety (distinct)
}
function revealAnswer(){
  const [a,b] = correctPairFor(targetN);
  $("revealEq").textContent = `1/${targetN} = 1/${a} + 1/${b}`;
  const L = lcm(a,b);
  const tShade = L/targetN;
  drawUnitBar($("revTarget"), L, tShade, 0);
  drawUnitBar($("revSum"), L, L/a, L/b);
  $("revealCard").classList.remove("hidden");
}

/* ---------- events ---------- */
$("checkBtn").onclick = ()=>{
  if(!(pick1 && pick2)) return;
  attempts++; $("attempts").textContent = attempts;

  if(pick1===pick2){
    $("cmpVerdict").innerHTML = `<span class="emoji">üö´</span><b>Denominators must be different.</b> Try a new pair.`;
  }else{
    const ok = isCorrect(targetN, pick1, pick2);
    const L = lcm(lcm(pick1, pick2), targetN);
    drawUnitBar($("cmpTarget"), L, L/targetN, 0);
    drawUnitBar($("cmpSum"), L, L/pick1, L/pick2);

    if(ok){
      score++; $("score").textContent = score;
      $("cmpVerdict").innerHTML = `<span class="emoji">üéØ</span><b>Awesome! Right on target!</b> ${encouragement()}`;
    }else{
      wrongAttempts++;
      const bigger = (1/pick1 + 1/pick2) > (1/targetN);
      $("cmpVerdict").innerHTML =
        `<span class="emoji">ü§î</span><b>Oops! Try again, I know you can do it!</b>
         <div class="note" style="margin-top:4px">
         Our sum is <b>${bigger?"bigger":"smaller"}</b> than 1/${targetN}.
         Next try: use <b>${bigger?"bigger":"smaller"}</b> denominators (${bigger?"that makes each unit fraction smaller":"that makes each unit fraction bigger"}).
         </div>`;
      if(wrongAttempts>=5){ revealAnswer(); }
    }
  }

  if(attempts>=5){ allowNext = true; $("nextBtn").disabled = false; }
  $("helper").innerHTML = `Attempts: <b>${attempts}</b>/5. ${encouragement()}`;
};
$("resetBtn").onclick = ()=>{
  pick1 = pick2 = null; $("cmpVerdict").textContent = ""; render();
};
$("nextBtn").onclick = ()=>{
  q++; $("qNo").textContent = q>10?10:q;
  newQuestion(decideNextLevel());
};

/* ---------- boot ---------- */
newQuestion();
</script>
</body>
</html>
