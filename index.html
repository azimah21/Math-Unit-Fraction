<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc;
    --card:#ffffff;
    --ink:#0f172a;
    --muted:#475569;
    --accent:#2563eb;
    --accent-soft:rgba(37,99,235,.15);
    --ok:#16a34a;
    --bad:#dc2626;
    --chip:#e2e8f0;
    --ring:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    background:var(--bg); color:var(--ink);
  }
  header{padding:20px 16px 8px}
  h1{margin:0 0 4px;font-size:clamp(26px,3vw,40px);font-weight:800;letter-spacing:.2px}
  .sub{color:var(--muted)}
  .wrap{max-width:1100px;margin:0 auto;padding:0 16px 56px;display:grid;gap:16px;
        grid-template-columns: 1fr; }
  @media (min-width: 980px){ .wrap{ grid-template-columns: 2fr 1fr; } }

  .card{
    background:var(--card); border-radius:16px; box-shadow:0 6px 18px rgba(2,6,23,.06);
    padding:16px 16px;
  }
  .card h2{margin:0 0 8px;font-size:20px}
  .meta{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 12px}
  .pill{background:#eef2ff;color:#1e293b;border-radius:999px;padding:6px 10px;font-size:13px}
  .block{margin:10px 0}
  .eqn{
    border:1px solid var(--ring);border-radius:12px;padding:12px 14px;background:#f8fafc;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  }
  .vizRow{display:flex;flex-direction:column;gap:10px}
  .barWrap .label{font-size:14px;margin-bottom:6px}
  .bar{
    height:18px;border:1px solid var(--ring);border-radius:8px;overflow:hidden;display:flex;background:white;
  }
  .seg{flex:1;border-right:1px solid var(--ring)}
  .shaded{background:var(--accent-soft)}
  .area{display:grid;gap:12px}
  .grid-btns{
    display:grid;grid-template-columns: repeat(4, 1fr); gap:12px;
  }
  .btn{
    background:var(--chip);border:2px solid transparent;border-radius:14px;padding:14px 10px;
    font-weight:700;text-align:center;cursor:pointer;user-select:none;
  }
  .btn:hover{filter:brightness(.98)}
  .btn.sel{border-color:var(--accent);background:#fff}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .primary{background:var(--accent);color:#fff}
  .ghost{background:#eef2ff}
  .muted{color:var(--muted)}
  .coach h3{margin:0 0 8px}
  .coach .hint{font-size:14px;color:var(--muted);margin:4px 0 10px}
  .result{
    margin-top:8px; display:flex; align-items:center; gap:8px; font-weight:700;
  }
  .result.ok{color:var(--ok)} .result.bad{color:var(--bad)}
  .tiny{font-size:12px;color:var(--muted)}
  .note{font-size:14px;color:var(--muted)}
  .spacer{height:6px}
</style>
</head>
<body>
  <header>
    <h1>Unit Fraction Builder</h1>
    <div class="sub">Let’s make this fraction: <b id="titleTarget">1/?</b>. Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</div>
  </header>

  <div class="wrap">
    <!-- LEFT: Game -->
    <main class="area">
      <!-- Meta -->
      <div class="meta">
        <div class="pill">Question <span id="qNum">1</span>/10</div>
        <div class="pill">Score <span id="score">0</span></div>
        <div class="pill">Target <span id="metaTarget">1/?</span></div>
      </div>

      <!-- TARGET / Equation + Visuals -->
      <section class="card">
        <h2>Target</h2>
        <div class="note">Make <b id="targetText">1/?</b> using two unit fractions.</div>

        <!-- Live equation -->
        <div class="block eqn" id="eqnBox">1/? = 1/&lowast; + 1/&lowast;</div>
        <div class="tiny">Pick two denominators below. The equation will update.</div>

        <!-- Stacked visuals: Target, 1st pick, 2nd pick -->
        <div class="vizRow" style="margin-top:12px">
          <div class="barWrap">
            <div class="label"><b>Visual of the target</b> (<span id="vizTargetLbl">1/?</span>)</div>
            <div id="barTarget" class="bar"></div>
            <div class="tiny" id="barTargetTxt"></div>
          </div>

          <div class="barWrap">
            <div class="label"><b>Visual of your 1st pick</b></div>
            <div id="barA" class="bar"></div>
            <div class="tiny" id="barATxt"></div>
          </div>

          <div class="barWrap">
            <div class="label"><b>Visual of your 2nd pick</b></div>
            <div id="barB" class="bar"></div>
            <div class="tiny" id="barBTxt"></div>
          </div>
        </div>
      </section>

      <!-- Buttons -->
      <section class="card">
        <h2>Pick exactly two denominators</h2>
        <div id="btnGrid" class="grid-btns"></div>

        <div class="row">
          <button id="checkBtn" class="btn primary">Check Answer</button>
          <button id="resetBtn" class="btn">Reset Selection</button>
          <button id="nextBtn" class="btn ghost" disabled>Next ▸</button>
        </div>
        <div class="note" id="statusNote">Pick two denominators, then press Check.</div>
      </section>

      <!-- Compare panel -->
      <section class="card" id="compareCard" style="display:none;">
        <h2>Compare: Your sum vs Target</h2>
        <div class="tiny">We shade pieces using a <b>common split</b> so both bars can be compared fairly.</div>
        <div class="spacer"></div>

        <div class="barWrap">
          <div class="label"><b>Your sum</b> (<span id="sumLbl">1/a + 1/b</span>)</div>
          <div id="barSum" class="bar"></div>
          <div class="tiny" id="sumTxt"></div>
        </div>

        <div class="barWrap" style="margin-top:10px">
          <div class="label"><b>Target</b> (<span id="cmpTargetLbl">1/n</span>)</div>
          <div id="barCmpTarget" class="bar"></div>
          <div class="tiny" id="cmpTargetTxt"></div>
        </div>

        <div id="resultMsg" class="result"></div>
      </section>
    </main>

    <!-- RIGHT: Coach -->
    <aside class="card coach">
      <h3>Think-Aloud Coach</h3>
      <div id="coachPrompt" class="hint">
        If our target is <b>1/n</b>, that’s a small amount. Unit fractions get
        smaller when denominators get bigger. Try a number linked to the target
        first (like a factor or a “same-family” number). After your first pick,
        decide if the second should be bigger or smaller.
      </div>

      <div style="margin-top:10px">
        <div class="label"><b>Visuals of your picks</b></div>
        <div id="coachBarA" class="bar" style="margin:6px 0 2px"></div>
        <div class="tiny" id="coachTxtA"></div>

        <div id="coachBarB" class="bar" style="margin:10px 0 2px"></div>
        <div class="tiny" id="coachTxtB"></div>
      </div>
    </aside>
  </div>

<script>
/* ---------- Helpers ---------- */
const byId = (id)=>document.getElementById(id);
function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }
function renderBar(el, parts, shadedParts){
  clear(el);
  if (parts <= 0) return;
  const shade = Math.max(0, Math.min(parts, shadedParts));
  for(let i=0;i<parts;i++){
    const d = document.createElement('div');
    d.className = 'seg' + (i<shade ? ' shaded' : '');
    if (i===parts-1) d.style.borderRight='none';
    el.appendChild(d);
  }
}
function gcd(a,b){ while(b){ [a,b]=[b,a%b]; } return a; }
function lcm(a,b){ return a*b/gcd(a,b); }

/* ---------- Game State ---------- */
const state = {
  q: 1, totalQ: 10, score: 0,
  n: 10, // target denominator
  a: null, b: null, // picks
  correctPair: null,
  choices: [],
};

/* ---------- Generate a target and a valid pair within 1..20 ---------- */
function generateTargetAndPair(){
  // keep n small enough so a and b <= 20 via (a-n)(b-n)=n^2
  for(let tries=0; tries<200; tries++){
    const n = Math.floor(Math.random()*12)+4; // 4..15 (tends to keep a,b <=20)
    const n2 = n*n;
    // get divisors for n^2
    const divisors = [];
    for(let d=1; d*d<=n2; d++){
      if(n2 % d === 0){ divisors.push(d); if(d*d!==n2) divisors.push(n2/d); }
    }
    // shuffle
    divisors.sort(()=>Math.random()-0.5);
    for(const k of divisors){
      const a = n + k;
      const b = n + (n2 / k);
      if(a>=1 && b>=1 && a<=20 && b<=20 && a!==b){ 
        return { n, a: Math.min(a,b), b: Math.max(a,b) };
      }
    }
  }
  // Fallback (rare)
  return { n: 8, a: 5, b: 20 };
}

/* ---------- Build choices 1..20 with guaranteed valid pair present ---------- */
function buildChoices(validA, validB){
  const pool = Array.from({length:20}, (_,i)=>i+1).filter(x=>x>=2); // 2..20
  // remove to avoid too many repeats, then add back valid pair
  const set = new Set();
  set.add(validA); set.add(validB);
  // add 6 distractors
  while(set.size<8){
    const pick = pool[Math.floor(Math.random()*pool.length)];
    set.add(pick);
  }
  // shuffle
  const arr = Array.from(set);
  arr.sort(()=>Math.random()-0.5);
  return arr;
}

/* ---------- UI Update ---------- */
function refreshMeta(){
  byId('qNum').textContent = state.q;
  byId('score').textContent = state.score;
  byId('metaTarget').textContent = `1/${state.n}`;
  byId('titleTarget').textContent = `1/${state.n}`;
  byId('targetText').textContent = `1/${state.n}`;
  byId('vizTargetLbl').textContent = `1/${state.n}`;
  byId('cmpTargetLbl').textContent = `1/${state.n}`;
  byId('eqnBox').textContent = `1/${state.n} = ${state.a?`1/${state.a}`:'1/*'} + ${state.b?`1/${state.b}`:'1/*'}`;
}

function refreshBars(){
  // target bar
  renderBar(byId('barTarget'), state.n, 1);
  byId('barTargetTxt').textContent = `Target shaded pieces: ${1}/${state.n}.`;

  // pick bars
  if(state.a){
    renderBar(byId('barA'), state.a, 1);
    byId('barATxt').textContent = `You chose 1/${state.a}. The bar is split into ${state.a} equal parts; one part is shaded.`;
    renderBar(byId('coachBarA'), state.a, 1);
    byId('coachTxtA').textContent = `You chose 1/${state.a}.`;
  }else{
    clear(byId('barA')); byId('barATxt').textContent = ''; clear(byId('coachBarA')); byId('coachTxtA').textContent='';
  }
  if(state.b){
    renderBar(byId('barB'), state.b, 1);
    byId('barBTxt').textContent = `You also chose 1/${state.b}. The bar is split into ${state.b} equal parts; one part is shaded.`;
    renderBar(byId('coachBarB'), state.b, 1);
    byId('coachTxtB').textContent = `You also chose 1/${state.b}.`;
  }else{
    clear(byId('barB')); byId('barBTxt').textContent = ''; clear(byId('coachBarB')); byId('coachTxtB').textContent='';
  }
}

function renderChoices(){
  const grid = byId('btnGrid'); clear(grid);
  state.choices.forEach(v=>{
    const b = document.createElement('button');
    b.className = 'btn';
    b.textContent = v;
    b.onclick = ()=>{
      if(state.a && state.b && !(state.a===v || state.b===v)){
        // replace the oldest
        state.a = state.b; state.b = v;
      }else if(!state.a || state.a===v){ state.a = v; }
      else if(!state.b || state.b===v){ state.b = v; }
      markSelections();
      refreshMeta(); refreshBars(); updateEquation();
    };
    b.dataset.val = v;
    grid.appendChild(b);
  });
  markSelections();
}

function markSelections(){
  document.querySelectorAll('#btnGrid .btn').forEach(btn=>{
    const v = Number(btn.dataset.val);
    btn.classList.toggle('sel', v===state.a || v===state.b);
  });
}

function updateEquation(){
  byId('eqnBox').textContent = `1/${state.n} = ${state.a?`1/${state.a}`:'1/*'} + ${state.b?`1/${state.b}`:'1/*'}`;
}

/* ---------- Compare (LCM) + Result ---------- */
function showCompare(){
  if(!(state.a && state.b)) return;

  const l = lcm(state.n, lcm(state.a, state.b));
  const sumShade = l/state.a + l/state.b;
  const targetShade = l/state.n;

  renderBar(byId('barSum'), l, sumShade);
  renderBar(byId('barCmpTarget'), l, targetShade);

  byId('sumLbl').textContent = `1/${state.a} + 1/${state.b}`;
  byId('sumTxt').textContent = `Common split: ${l}. Your shaded pieces: ${sumShade}/${l}.`;
  byId('cmpTargetTxt').textContent = `Target shaded pieces: ${targetShade}/${l}.`;

  const same = (sumShade === targetShade);
  const msg = byId('resultMsg');
  msg.className = 'result ' + (same?'ok':'bad');
  msg.textContent = same ? '✅ Awesome! Right on target!' : '❌ Oops! Try again, I know you can do it!';
  byId('compareCard').style.display = 'block';
  return same;
}

/* ---------- Flow ---------- */
function newQuestion(){
  const {n,a,b} = generateTargetAndPair();
  state.n = n; state.a = null; state.b = null; state.correctPair = [a,b];
  state.choices = buildChoices(a,b);
  refreshMeta(); refreshBars(); renderChoices();
  byId('statusNote').textContent = 'Pick two denominators, then press Check.';
  byId('nextBtn').disabled = true;
  byId('compareCard').style.display = 'none';
  byId('coachPrompt').innerHTML =
    `Target is <b>1/${state.n}</b>. Try a number linked to ${state.n} first (factor or “same family”). 
     If your sum is too big, your denominators were too small; if too small, your denominators were too big.`;
}

byId('resetBtn').onclick = ()=>{
  state.a = null; state.b = null; markSelections(); refreshBars(); updateEquation();
  byId('compareCard').style.display='none';
};

byId('checkBtn').onclick = ()=>{
  if(!(state.a && state.b)){
    byId('statusNote').textContent = 'Pick two denominators first.';
    return;
  }
  const same = showCompare();
  if(same){ state.score++; byId('score').textContent = state.score; }
  // coach text
  const sum = 1/state.a + 1/state.b, target = 1/state.n;
  if (Math.abs(sum - target) < 1e-12){
    byId('coachPrompt').innerHTML = `Nice! What pattern did you notice about denominators that worked?
      How could you guess faster next time using that pattern?`;
  }else if (sum > target){
    byId('coachPrompt').innerHTML = `Our sum is <b>bigger</b> than 1/${state.n}. 
      Next try: use <b>bigger denominators</b> (that makes each unit fraction smaller).`;
  }else{
    byId('coachPrompt').innerHTML = `Our sum is <b>smaller</b> than 1/${state.n}. 
      Next try: use <b>smaller denominators</b> (that makes each unit fraction bigger).`;
  }
  byId('nextBtn').disabled = false;
};

byId('nextBtn').onclick = ()=>{
  state.q = Math.min(state.totalQ, state.q+1);
  newQuestion();
};

/* ---------- Init ---------- */
newQuestion();
</script>
</body>
</html>



