<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc;
    --card:#ffffff;
    --ink:#1f2937;
    --muted:#6b7280;
    --brand:#2563eb;
    --brand-weak:#e8f0fe;
    --ok:#16a34a;
    --no:#dc2626;
    --ring: rgba(37,99,235,.25);
    --bar:#e5e7eb;
    --shade:#93c5fd;
    --chip:#eef2ff;
    --chip-ink:#3730a3;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    background:var(--bg); color:var(--ink);
  }
  .wrap{max-width:1040px; margin:24px auto; padding:0 16px;}
  h1{font-size:40px; margin:0 0 4px 0}
  .lede{color:var(--muted); margin-bottom:18px}
  .row{display:grid; grid-template-columns: 1fr 340px; gap:16px}
  @media (max-width:1000px){ .row{grid-template-columns: 1fr} }

  .card{
    background:var(--card); border-radius:16px; padding:16px 18px; box-shadow: 0 1px 2px rgba(0,0,0,.06);
  }
  .card + .card{margin-top:12px}
  .title{font-weight:700; font-size:18px; margin-bottom:10px}
  .pillrow{display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 14px}
  .pill{
    background:var(--chip); color:var(--chip-ink); border-radius:999px; padding:6px 10px; font-size:13px; font-weight:700;
  }

  .grid{
    display:grid; grid-template-columns: repeat(4, 1fr); gap:12px;
  }
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    border:1px solid #e5e7eb; border-radius:14px; padding:12px 14px; background:#fff; font-weight:700; cursor:pointer;
    transition: box-shadow .15s, border-color .15s, transform .02s;
  }
  .btn:active{ transform: translateY(1px); }
  .btn:hover{ box-shadow: 0 0 0 3px var(--ring); border-color: var(--brand-weak); }
  .btn.primary{ background:var(--brand); color:white; border-color:var(--brand); }
  .btn.gray{ background:#f3f4f6; }
  .btn:disabled{opacity:.55; cursor:not-allowed; box-shadow:none}

  .denom{height:54px; font-size:18px}
  .denom.selected{outline:3px solid var(--brand); outline-offset:2px}

  .eq{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:14px; font-size:18px; text-align:center;
  }
  .muted{color:var(--muted); font-size:14px}

  .bar{
    height:16px; border:1px solid var(--bar); border-radius:8px; display:flex; overflow:hidden; background:white;
  }
  .segment{flex:1; border-right:1px solid var(--bar)}
  .segment:last-child{border-right:none}
  .segment.shade{ background:var(--shade); }

  .coach h3{margin:0 0 8px 0; font-size:22px}
  .coach .muted{font-size:13px}

  .compare h3{margin:0 0 8px 0; font-size:20px}
  .cmpRow{display:grid; grid-template-columns: 1fr; gap:10px}
  .cmpLine .label{font-weight:700; margin-bottom:6px}
  .cmpLine .small{color:var(--muted); font-size:13px; margin-top:6px}

  .result{margin-top:8px; font-weight:800}
  .ok{color:var(--ok)} .no{color:var(--no)}

  .stats{display:flex; gap:12px; flex-wrap:wrap}
  .stats .pill{background:#ecfeff; color:#0e7490}

  .footer-note{color:var(--muted); font-size:12px; margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <div class="lede">Let‚Äôs make this fraction: <b id="ledeTarget">1/?</b>. Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</div>

    <div class="pillrow">
      <span class="pill">Question <span id="qNum">1</span>/10</span>
      <span class="pill">Score <span id="score">0</span></span>
      <span class="pill">Target <span id="pillTarget">1/?</span></span>
      <span class="pill">Attempts <span id="attemptsPill">0</span>/5</span>
      <span class="pill">Wrong <span id="wrongsPill">0</span></span>
    </div>

    <div class="row">
      <!-- LEFT: main game -->
      <div>
        <div class="card">
          <div class="title">Target</div>
          <div class="muted">Make <b id="targetText">1/?</b> using two unit fractions.</div>

          <!-- live equation -->
          <div class="card" style="margin-top:12px">
            <div class="eq" id="equation">1/? = 1/‚Äì + 1/‚Äì</div>
            <div class="muted" style="margin-top:8px">Pick two denominators below. The equation will update.</div>
          </div>

          <!-- stacked visuals -->
          <div class="card" style="margin-top:12px">
            <div class="title" style="margin-bottom:12px">Visuals</div>

            <div class="muted">Target (1/<span id="vizTargetN">?</span>)</div>
            <div id="barTarget" class="bar" style="margin:6px 0 12px"></div>
            <div class="muted" id="barTargetNote"></div>

            <div class="muted" style="margin-top:14px">Your 1st pick (1/<span id="vizA">‚Äì</span>)</div>
            <div id="barA" class="bar" style="margin:6px 0 12px"></div>
            <div class="muted" id="barANote"></div>

            <div class="muted" style="margin-top:14px">Your 2nd pick (1/<span id="vizB">‚Äì</span>)</div>
            <div id="barB" class="bar" style="margin:6px 0 12px"></div>
            <div class="muted" id="barBNote"></div>
          </div>
        </div>

        <div class="card">
          <div class="title">Pick exactly two denominators</div>
          <div id="denomGrid" class="grid" style="margin-top:8px"></div>

          <div style="display:flex; gap:10px; margin-top:16px; flex-wrap:wrap">
            <button id="checkBtn" class="btn primary">Check Answer</button>
            <button id="resetBtn" class="btn gray">Reset Selection</button>
            <button id="nextBtn" class="btn" disabled>Next ‚ñ∏</button>
          </div>
          <div class="muted" id="hint" style="margin-top:10px">Pick two denominators, then press <b>Check</b>.</div>

          <div class="card compare" style="margin-top:14px">
            <h3>Compare: Your sum vs Target</h3>
            <div class="muted">We shade pieces using a common split so both bars can be compared fairly.</div>
            <div class="cmpRow" style="margin-top:10px">
              <div class="cmpLine">
                <div class="label">Your sum (1/a + 1/b)</div>
                <div id="barSum" class="bar"></div>
                <div class="small" id="barSumNote"></div>
              </div>
              <div class="cmpLine" style="margin-top:10px">
                <div class="label">Target (1/n)</div>
                <div id="barCompareTarget" class="bar"></div>
                <div class="small" id="barCompareNote"></div>
              </div>
            </div>
            <div id="cmpResult" class="result"></div>
          </div>

          <div class="card" style="margin-top:14px">
            <div class="title">Progress</div>
            <div class="stats">
              <span class="pill">Attempts: <span id="attemptsTxt">0</span>/5</span>
              <span class="pill">Wrong tries: <span id="wrongsTxt">0</span></span>
            </div>
            <div class="muted footer-note" id="progressNote"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Think-Aloud Coach -->
      <div class="card coach">
        <h3>Think-Aloud Coach</h3>
        <div id="coachPrompt" class="muted">
          Let‚Äôs get started. First, look at the target. Is it a small or big piece?
          Try one number you think could work. Why that one?
        </div>

        <div class="card" style="margin-top:12px">
          <div class="title" style="margin-bottom:6px">Visuals of your picks</div>
          <div class="muted" id="coachA">You haven‚Äôt picked your first number yet.</div>
          <div id="coachBarA" class="bar" style="margin:6px 0 10px"></div>
          <div class="muted" id="coachB">Pick your second number when ready.</div>
          <div id="coachBarB" class="bar" style="margin:6px 0 0"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- helpers ---------- */
const $ = sel => document.querySelector(sel);
function clear(el){ while(el.firstChild) el.removeChild(el.firstChild); }
const clamp = (x,a,b)=> Math.max(a, Math.min(b,x));
const gcd = (a,b)=> b?gcd(b,a%b):a;
const lcm2 = (a,b)=> a*b/gcd(a,b);
const lcm3 = (a,b,c)=> lcm2(lcm2(a,b),c);

/* fraction bars */
function renderBar(el, parts, shaded){
  clear(el);
  parts = clamp(parts, 1, 120); // avoid too many DOM nodes
  shaded = clamp(shaded, 0, parts);
  for(let i=0;i<parts;i++){
    const d = document.createElement('div');
    d.className = 'segment' + (i < shaded ? ' shade' : '');
    el.appendChild(d);
  }
}

/* ---------- game state ---------- */
const state = {
  q: 1, score: 0,
  level: 2, // 1 easy, 2 medium, 3 hard
  targetN: 10,
  pickA: null, pickB: null,
  attempts: 0, wrongs: 0, solved: false,
};

/* target range by level (all within 6..20 for nice visuals) */
function genTarget(level){
  const rng = {
    1: [6,10], // easier (bigger pieces)
    2: [8,14], // medium
    3: [12,20], // harder (smaller pieces)
  }[level||2];
  const n = randFromRange(rng[0], rng[1]);
  return n;
}
function randFromRange(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

/* denominator list 2..20 */
const DENOMS = Array.from({length:19},(_,i)=>i+2);

/* ---------- UI wiring ---------- */
const denomGrid = $('#denomGrid');
function drawDenoms(){
  clear(denomGrid);
  const pool = shuffle([...DENOMS]).slice(0,8); // 8 buttons per round
  pool.forEach(val=>{
    const btn = document.createElement('button');
    btn.className = 'btn denom';
    btn.textContent = val;
    btn.addEventListener('click', ()=>{
      onPick(val, btn);
    });
    denomGrid.appendChild(btn);
  });
}
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

/* picks */
function onPick(val, btn){
  if(state.pickA===null){ state.pickA = val; btn.classList.add('selected'); updatePicks(); coach.onFirstPick(val); return; }
  if(state.pickB===null && val!==state.pickA){ state.pickB = val; btn.classList.add('selected'); updatePicks(); return; }
  // toggle logic
  if(state.pickA===val){ state.pickA=null; btn.classList.remove('selected'); updatePicks(); }
  else if(state.pickB===val){ state.pickB=null; btn.classList.remove('selected'); updatePicks(); }
}

/* equation + visuals */
function updateEquation(){
  const n = state.targetN;
  const a = state.pickA ?? '‚Äì';
  const b = state.pickB ?? '‚Äì';
  $('#equation').textContent = `1/${n} = 1/${a} + 1/${b}`;
}

function updatePicks(){
  updateEquation();

  // target bar
  $('#vizTargetN').textContent = state.targetN;
  const targSplit = Math.min(60, state.targetN*1); // cap segments
  renderBar($('#barTarget'), targSplit, Math.max(1, Math.round(targSplit/state.targetN)));
  $('#barTargetNote').textContent = `Target shaded pieces: ${Math.round(targSplit/state.targetN)}/${targSplit}.`;

  // A
  $('#vizA').textContent = state.pickA ?? '‚Äì';
  if(state.pickA){
    const sp = Math.min(60,state.pickA);
    renderBar($('#barA'), sp, 1);
    $('#barANote').textContent = `You chose 1/${state.pickA}. The bar is split into ${state.pickA} equal parts; one part is shaded.`;
    renderBar($('#coachBarA'), sp, 1);
    $('#coachA').textContent = `You chose 1/${state.pickA}.`;
  }else{
    clear($('#barA')); $('#barANote').textContent=''; clear($('#coachBarA')); $('#coachA').textContent='Pick your first number.';
  }

  // B
  $('#vizB').textContent = state.pickB ?? '‚Äì';
  if(state.pickB){
    const sp = Math.min(60,state.pickB);
    renderBar($('#barB'), sp, 1);
    $('#barBNote').textContent = `You chose 1/${state.pickB}. The bar is split into ${state.pickB} equal parts; one part is shaded.`;
    renderBar($('#coachBarB'), sp, 1);
    $('#coachB').textContent = `You also chose 1/${state.pickB}.`;
  }else{
    clear($('#barB')); $('#barBNote').textContent=''; clear($('#coachBarB')); $('#coachB').textContent='Pick your second number when ready.';
  }

  // compare section (only if both picked)
  drawCompare();
}

function drawCompare(){
  const n = state.targetN, a = state.pickA, b = state.pickB;
  if(!(a && b)){
    clear($('#barSum')); clear($('#barCompareTarget'));
    $('#barSumNote').textContent = ''; $('#barCompareNote').textContent = '';
    $('#cmpResult').textContent = '';
    return;
  }
  const L = Math.min(120, lcm3(n,a,b));
  const shadedSum = Math.round(L/a) + Math.round(L/b);
  const shadedTarget = Math.round(L/n);
  renderBar($('#barSum'), L, shadedSum);
  renderBar($('#barCompareTarget'), L, shadedTarget);
  $('#barSumNote').textContent = `Common split: ${L}; your shaded pieces: ${shadedSum}/${L}.`;
  $('#barCompareNote').textContent = `Target shaded pieces: ${shadedTarget}/${L}.`;

  if(shadedSum === shadedTarget){
    $('#cmpResult').innerHTML = `<span class="ok">‚úÖ Awesome! Right on target!</span>`;
  }else if(shadedSum > shadedTarget){
    $('#cmpResult').innerHTML = `<span class="no">üßê Oops! Your sum is bigger. Try larger denominators.</span>`;
  }else{
    $('#cmpResult').innerHTML = `<span class="no">üßê Oops! Your sum is smaller. Try smaller denominators? (or re-think the pair)</span>`;
  }
}

/* ---------- coach prompts ---------- */
const coach = (() => {
  const prompt = $("#coachPrompt");
  return {
    start(n){
      prompt.innerHTML =
        `Let‚Äôs make <b>1/${n}</b>.<br>
         Is that a small piece or a big piece? Pick one number to try. Why that one?`;
    },
    onFirstPick(a){
      prompt.innerHTML =
        `Nice pick. How will you find the second number?<br>
         ‚Ä¢ Try a number in the same family first (linked to your first pick or to the target).<br>
         ‚Ä¢ If the sum is too big, your numbers were too small. If too small, your numbers were too big.`;
    },
    onCheck({sumTooBig, sumTooSmall, correct, n}){
      if(correct){
        prompt.innerHTML = `Great! Your pair makes <b>1/${n}</b>. What pattern did you notice?`;
      }else if(sumTooBig){
        prompt.innerHTML = `Our sum is bigger than <b>1/${n}</b>. Next try: use <b>bigger denominators</b> (each unit gets smaller).`;
      }else if(sumTooSmall){
        prompt.innerHTML = `Our sum is smaller than <b>1/${n}</b>. Next try: use <b>smaller denominators</b> (each unit gets bigger).`;
      }else{
        prompt.innerHTML = `Keep reasoning: estimate ‚Üí choose ‚Üí compare ‚Üí adjust.`;
      }
    }
  };
})();

/* ---------- checking, attempts, adaptivity ---------- */
function updatePills(){
  $('#qNum').textContent = state.q;
  $('#score').textContent = state.score;
  $('#pillTarget').textContent = `1/${state.targetN}`;
  $('#ledeTarget').textContent = `1/${state.targetN}`;
  $('#targetText').textContent = `1/${state.targetN}`;
  $('#attemptsPill').textContent = state.attempts;
  $('#wrongsPill').textContent = state.wrongs;
  $('#attemptsTxt').textContent = state.attempts;
  $('#wrongsTxt').textContent = state.wrongs;
}

function checkAnswer(){
  if(!(state.pickA && state.pickB)) { $('#hint').textContent = 'Pick two denominators first üôÇ'; return; }

  const n = state.targetN, a = state.pickA, b = state.pickB;
  const correct = (a + b) === n ? true : ( (1/a + 1/b) === (1/n) ); // primary rule is n(a+b)=ab; but equality of floats rarely exact
  // Use integer check
  const isEqual = (n*(a+b) === a*b);

  state.attempts += 1;
  const sum = 1/a + 1/b;
  const sumTooBig = sum > 1/n && !isEqual;
  const sumTooSmall = sum < 1/n && !isEqual;

  if(isEqual){ state.solved = true; state.score += 1; $('#hint').textContent = '‚úÖ Correct! Try a few more ideas before moving on.'; }
  else{ state.wrongs += 1; $('#hint').textContent = 'Not yet. Look at the compare bars and adjust your pair.'; }

  // compare bars already drawn; update prompts
  coach.onCheck({sumTooBig, sumTooSmall, correct: isEqual, n});

  // progress & gate
  updatePills();
  $('#progressNote').textContent =
    state.attempts >= 5
      ? 'You have tried 5 times. You can now move to the next question whenever you‚Äôre ready.'
      : 'Keep going. Next unlocks after 5 tries ‚Äî explore and learn!';

  if(state.attempts >= 5){ $('#nextBtn').disabled = false; }
}

function resetSelection(){
  state.pickA = null; state.pickB = null;
  [...document.querySelectorAll('.denom')].forEach(b=>b.classList.remove('selected'));
  updatePicks();
  $('#hint').textContent = 'Pick two denominators, then press Check.';
  $('#cmpResult').textContent = '';
}

function gotoNext(){
  // decide next difficulty based on wrongs at time of unlock/press
  let msg='';
  if(state.wrongs === 0){
    state.level = clamp(state.level+1,1,3);
    msg = "You nailed it! Let's give you something more challenging!";
  }else if(state.wrongs === 3){
    // keep same
    msg = "You're on track! Keep going!";
  }else if(state.wrongs > 3){
    state.level = clamp(state.level-1,1,3);
    msg = "Hang in there! We'll help you out!";
  }else{
    // 1‚Äì2 wrong ‚Üí mild nudge harder but not required
    msg = "Nice learning! Let's keep building.";
  }

  state.q += 1;
  // new round
  state.targetN = genTarget(state.level);
  state.pickA = state.pickB = null;
  state.attempts = 0; state.wrongs = 0; state.solved = false;

  // refresh UI
  $('#nextBtn').disabled = true;
  $('#hint').textContent = msg;
  $('#equation').textContent = `1/${state.targetN} = 1/‚Äì + 1/‚Äì`;
  $('#ledeTarget').textContent = `1/${state.targetN}`;
  $('#targetText').textContent = `1/${state.targetN}`;
  $('#pillTarget').textContent = `1/${state.targetN}`;
  updatePills();
  drawDenoms();
  updatePicks();
  coach.start(state.targetN);
}

/* ---------- boot ---------- */
function start(){
  state.targetN = genTarget(state.level);
  updatePills();
  $('#ledeTarget').textContent = `1/${state.targetN}`;
  $('#targetText').textContent = `1/${state.targetN}`;
  $('#pillTarget').textContent = `1/${state.targetN}`;
  drawDenoms();
  updatePicks();
  coach.start(state.targetN);

  $('#checkBtn').addEventListener('click', checkAnswer);
  $('#resetBtn').addEventListener('click', resetSelection);
  $('#nextBtn').addEventListener('click', gotoNext);
}
start();
</script>
</body>
</html>
