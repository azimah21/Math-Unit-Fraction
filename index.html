<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc;
    --card:#ffffff;
    --text:#102a43;
    --muted:#486581;
    --accent:#2563eb;
    --accent-weak:#dbeafe;
    --success:#16a34a;
    --danger:#dc2626;
    --shadow:0 8px 20px rgba(16,42,67,.06);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--text); background:var(--bg); line-height:1.45;
  }
  .wrap{max-width:900px; margin:24px auto 80px; padding:0 16px;}
  h1{font-size:clamp(28px,4vw,40px); margin:8px 0 4px;}
  .sub{color:var(--muted); margin:0 0 18px; font-size:clamp(14px,2.3vw,18px)}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
  .pill{background:var(--accent-weak); color:#1e3a8a; padding:8px 12px; border-radius:999px; font-weight:600}
  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:18px; margin:14px 0}
  .card h3{margin:0 0 10px}
  .grid{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
  .btn{
    appearance:none; border:2px solid transparent; border-radius:14px; padding:12px 16px;
    background:#eef2ff; color:#1e293b; font-weight:700; cursor:pointer;
  }
  .btn:hover{filter:brightness(0.98)}
  .btn.primary{background:var(--accent); color:white}
  .btn.ghost{background:white; border-color:#e5e7eb}
  .btn:disabled{opacity:.5; cursor:not-allowed}
  .choice{
    border:2px solid #e5e7eb; border-radius:14px; padding:14px 0; text-align:center;
    background:white; font-weight:800; font-size:18px; cursor:pointer;
  }
  .choice.selected{border-color:var(--accent); outline:3px solid var(--accent-weak)}
  .msg{margin-top:10px; font-weight:700}
  .msg.ok{color:var(--success)} .msg.no{color:var(--danger)}

  /* simple fraction bar svg sizing */
  .illu{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
  svg{max-width:260px; width:100%; height:auto}
  .small{color:var(--muted); font-size:14px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <p class="sub">Pick two unit fractions <em>1/a</em> and <em>1/b</em> whose sum equals the target <em>1/n</em>.</p>

    <!-- top status bar -->
    <div class="bar">
      <div><strong>Question:</strong> <span id="qnum">1</span>/10</div>
      <div><strong>Score:</strong> <span id="score">0</span></div>
      <div><strong>Target:</strong> <span id="targetLabel">1/6</span></div>
    </div>
    <div class="progress" aria-label="progress"><span id="progressFill"></span></div>

    <!-- target & selection -->
    <div class="card">
      <div class="title">Target</div>
      <div id="targetPretty" class="muted">1/6</div>
    </div>

    <div class="card">
      <div class="title">Your Selection</div>
      <div id="selection" class="muted">Pick exactly two denominators below.</div>
    </div>

    <!-- candidates -->
    <div class="card">
      <div class="title">Pick exactly two denominators</div>
      <div id="grid" class="grid" role="group" aria-label="denominator choices"></div>
      <div class="row" style="margin-top:14px">
        <button id="checkBtn" class="btn primary">Check Answer</button>
        <button id="resetBtn" class="btn">Reset Selection</button>
        <button id="nextBtn" class="btn ghost" title="Skip to next">Next ▸</button>
      </div>
      <div id="feedback" class="feedback muted"></div>
    </div>

    <!-- how it works -->
    <div class="card">
      <div class="title">How it works</div>
      <p class="muted">
        We want <code>1/a + 1/b = 1/n</code>. That’s true exactly when
        <code>n(a + b) = ab</code>. For each question the game chooses a target
        denominator <code>n</code> and generates a valid pair <code>(a,b)</code>, mixes in
        good distractors, and asks you to find the correct pair.
      </p>
      <p class="muted">
        Difficulty adapts to you: a short correct streak moves you up a level; a
        short struggle moves you down. You can tune the ranges in the code section
        marked <strong>“ADAPTIVE SETTINGS”</strong>.
      </p>
    </div>
  </div>

<script>
/* ======================== ADAPTIVE SETTINGS ======================== */
/* Level → pool of target n, and denominator ranges for candidates. */
const LEVELS = {
  1: { targets:[4,5,6,7,8,9], pool:[4,5,6,7,8,9,10,12], gridCount:8 },
  2: { targets:[6,7,8,9,10,12,14], pool:[5,6,7,8,9,10,11,12,14,15,16,18], gridCount:10 },
  3: { targets:[8,9,10,12,14,15,18,20,24], pool:[6,7,8,9,10,11,12,13,14,15,16,18,20,21,24], gridCount:12 }
};
/* How fast to move levels */
const STREAK_UP = 3; // three in a row → level up
const STREAK_DOWN = 3; // three misses → level down

/* ============================ STATE =============================== */
let questionNum = 0, totalQuestions = 10, score = 0;
let level = 1, winStreak = 0, loseStreak = 0;
let targetN = 6, correctPair = [3,6]; // a,b that solve 1/a + 1/b = 1/n
let picked = []; // current user choices
let locked = false;

/* ============================ UTILS =============================== */
const byId = id => document.getElementById(id);
const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
const gcd = (a,b)=>b?gcd(b,a%b):a;

/* Given n, create a valid (a,b) using the factor-pair trick:
   If (x*y = n^2), then a = n + n^2/x and b = n + x is a solution. */
function makeValidPair(n){
  const factors = [];
  for(let x=1; x*x<=n*n; x++){
    if((n*n)%x===0){ factors.push(x); if(x!==(n*n)/x) factors.push((n*n)/x); }
  }
  const x = factors[Math.floor(Math.random()*factors.length)];
  const a = n + Math.floor((n*n)/x);
  const b = n + x;
  return [a,b];
}

/* Build a candidate grid that contains the correct pair plus distractors. */
function buildCandidates(n, pair, gridCount){
  const pool = new Set(LEVELS[level].pool);
  pool.add(pair[0]); pool.add(pair[1]); // ensure present
  // add distractors that *almost* work or are plausible
  const near = [n-1,n+1,2*n-1,2*n,3*n-1,3*n].filter(v=>v>2);
  near.forEach(v=>pool.add(v));
  const list = Array.from(pool);
  const shuffled = shuffle(list).slice(0, gridCount-2);
  shuffled.push(pair[0], pair[1]);
  return shuffle(shuffled);
}

/* Check whether 1/a + 1/b == 1/n using integer math */
function isCorrectPair(a,b,n){
  return n*(a+b) === a*b;
}

/* ============================ RENDER ============================== */
function render(){
  byId('qnum').textContent = questionNum;
  byId('score').textContent = score;
  byId('targetLabel').textContent = `1/${targetN}`;
  byId('targetPretty').textContent = `Make 1/${targetN} using two unit fractions.`;
  byId('selection').textContent = picked.length ? picked.map(d=>`1/${d}`).join(' + ') : 'Pick exactly two denominators below.';
  byId('feedback').textContent = '';
  byId('feedback').className = 'feedback muted';
  byId('progressFill').style.width = `${(questionNum-1)/totalQuestions*100}%`;

  const grid = byId('grid');
  grid.innerHTML = '';
  const candidates = buildCandidates(targetN, correctPair, LEVELS[level].gridCount);
  candidates.forEach(val=>{
    const btn = document.createElement('button');
    btn.className = 'chip';
    btn.textContent = val;
    btn.addEventListener('click', ()=>{
      if(locked) return;
      const i = picked.indexOf(val);
      if(i>-1){ picked.splice(i,1); btn.classList.remove('selected'); }
      else{
        if(picked.length===2){ return; }
        picked.push(val);
        btn.classList.add('selected');
      }
      byId('selection').textContent = picked.length ? picked.map(d=>`1/${d}`).join(' + ') : 'Pick exactly two denominators below.';
    });
    grid.appendChild(btn);
  });

  // button states
  byId('checkBtn').disabled = false;
  byId('nextBtn').disabled = true;
  locked = false;
}

/* ========================= GAME FLOW ============================= */
function newQuestion(){
  if(questionNum>=totalQuestions){
    // finished set
    byId('progressFill').style.width = '100%';
    byId('feedback').className = 'feedback good';
    byId('feedback').textContent = `Great work! Final score: ${score}/${totalQuestions}.`;
    byId('grid').querySelectorAll('.chip').forEach(b=>b.classList.add('locked'));
    byId('checkBtn').disabled = true;
    byId('nextBtn').disabled = true;
    return;
  }
  questionNum++;
  // pick a target and make a valid pair for this level
  const targets = LEVELS[level].targets;
  targetN = targets[Math.floor(Math.random()*targets.length)];
  correctPair = makeValidPair(targetN);
  picked = [];
  render();
}

function grade(){
  if(picked.length!==2) {
    byId('feedback').className='feedback bad';
    byId('feedback').textContent='Pick exactly two denominators.';
    return;
  }
  const [a,b] = picked;
  const ok = isCorrectPair(a,b,targetN);
  locked = true;
  byId('grid').querySelectorAll('.chip').forEach(btn=>{
    btn.classList.add('locked');
    const val = Number(btn.textContent);
    // tiny visual cue: outline correct ones
    if((val===correctPair[0]||val===correctPair[1])) btn.style.outline='3px solid var(--accent-2)';
  });

  if(ok){
    score++;
    winStreak++; loseStreak=0;
    byId('feedback').className='feedback good';
    byId('feedback').textContent='Nice! That makes the target exactly.';
    if(winStreak>=STREAK_UP && level<3){ level++; winStreak=0; }
  }else{
    loseStreak++; winStreak=0;
    byId('feedback').className='feedback bad';
    byId('feedback').innerHTML = `Not quite. A correct pair for 1/${targetN} is <strong>1/${correctPair[0]} + 1/${correctPair[1]}</strong>.`;
    if(loseStreak>=STREAK_DOWN && level>1){ level--; loseStreak=0; }
  }

  byId('checkBtn').disabled = true;
  byId('nextBtn').disabled = false;
}

/* Buttons */
byId('checkBtn').addEventListener('click', grade);
byId('resetBtn').addEventListener('click', ()=>{ if(!locked){ picked=[]; render(); }});
byId('nextBtn').addEventListener('click', newQuestion);

/* Kick off */
newQuestion();
</script>
</body>
</html>




