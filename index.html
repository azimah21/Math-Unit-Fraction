<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --accent:#2563eb; --accent-2:#22c55e; --warn:#ef4444; --soft:#e2e8f0;
  }
  *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--ink)}
  header{padding:20px 16px 6px;max-width:980px;margin:auto}
  h1{margin:0 0 4px;font-size:34px}
  .sub{color:var(--muted)}
  main{max-width:980px;margin:8px auto;padding:0 16px 60px}
  .row{display:grid;grid-template-columns:1fr 340px;gap:16px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 10px rgba(2,6,23,.06);padding:16px}
  .title{font-weight:700;margin:0 0 10px}
  .pill{display:inline-block;background:#edf2ff;border:1px solid #c7d2fe;border-radius:999px;padding:6px 10px;margin:0 8px 8px 0;font-size:14px}
  .meta{display:flex;gap:8px;margin:6px 0 14px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{border:0;border-radius:12px;padding:12px 14px;font-weight:700;background:var(--accent);color:white;cursor:pointer;transition:transform .05s ease}
  .btn.secondary{background:#e5e7eb;color:#111827}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .choice{
    background:#e7eefb;border:2px solid transparent;border-radius:12px;padding:14px 0;text-align:center;font-weight:700;cursor:pointer;
    transition: box-shadow .15s ease, transform .05s ease, border-color .15s ease;
  }
  .choice:hover{box-shadow:0 0 0 3px rgba(37,99,235,.15)}
  .choice.selected{
    border-color:var(--accent); background:#eef5ff;
    box-shadow:0 0 0 3px rgba(37,99,235,.35);
  }
  .choice.disabled{opacity:.4;cursor:not-allowed}
  .eq{
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px
  }
  .muted{color:var(--muted);font-size:14px}
  .bar{height:16px;border:1px solid #e2e8f0;border-radius:8px;display:flex;overflow:hidden;background:white}
  .bar .seg{flex:1;border-right:1px solid #eef2f7}
  .note{font-size:13px;color:var(--muted);margin-top:6px}
  .ok{color:var(--accent-2);font-weight:700}
  .no{color:var(--warn);font-weight:700}
  .hidden{display:none}
  .coach h3{margin:0 0 8px}
  .coach ul{margin:8px 0 0 22px;padding:0}
  .right{display:flex;flex-direction:column;gap:12px}
  .cmpRow{display:grid;grid-template-columns:140px 1fr;gap:8px;align-items:center;margin:10px 0}
  .emoji{font-size:18px;margin-right:6px}
</style>
</head>
<body>
<header>
  <h1>Unit Fraction Builder</h1>
  <div class="sub">Let‚Äôs make this fraction: <b id="headlineTarget">1/8</b>.
    Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</div>
</header>

<main>
  <div class="meta">
    <span class="pill">Question <span id="qNo">1</span>/10</span>
    <span class="pill">Score <span id="score">0</span></span>
    <span class="pill">Target <span id="pillTarget">1/8</span></span>
    <span class="pill">Attempts <span id="attempts">0</span>/5</span>
  </div>

  <div class="row">
    <!-- LEFT -->
    <section class="card">
      <h2 class="title">Target</h2>
      <div class="muted" id="targetSentence">Make <b>1/8</b> using two unit fractions.</div>

      <!-- Live equation -->
      <div class="card" style="margin-top:12px">
        <div class="eq" id="liveEq">1/8 = 1/‚Äì + 1/‚Äì</div>
        <div class="muted">Pick two denominators below. The equation will update.</div>
      </div>

      <!-- Stacked visuals: target, pick1, pick2 -->
      <div class="card" style="margin-top:12px">
        <div class="cmpRow"><div class="muted"><b>Visual of the target</b></div>
          <div id="barTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Visual of your 1st pick</b></div>
          <div id="barPick1" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Visual of your 2nd pick</b></div>
          <div id="barPick2" class="bar"></div></div>
      </div>

      <!-- Compare box -->
      <div id="compareCard" class="card" style="margin-top:12px">
        <h3 class="title" style="margin-bottom:6px">Compare: Your sum vs Target</h3>
        <div class="muted">We shade pieces using a common split so both bars can be compared fairly.</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="cmpTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Your sum</b></div>
          <div id="cmpSum" class="bar"></div></div>
        <div class="muted" id="cmpText">Target shaded pieces: ‚Äì / ‚Äì.</div>
        <div id="cmpVerdict" class="muted" style="margin-top:6px"></div>
      </div>

      <!-- Reveal after 5 wrong -->
      <div id="revealCard" class="card hidden" style="margin-top:12px;border:1px dashed #cbd5e1">
        <h3 class="title">Here‚Äôs one correct way</h3>
        <div class="eq" id="revealEq">1/8 = 1/5 + 1/20</div>
        <div class="muted" style="margin-top:6px">Watch how the two unit fractions add up (two colours):</div>
        <div class="cmpRow"><div class="muted"><b>Target</b></div>
          <div id="revTarget" class="bar"></div></div>
        <div class="cmpRow"><div class="muted"><b>Correct sum</b></div>
          <div id="revSum" class="bar"></div></div>
      </div>

      <!-- Choices -->
      <h3 class="title" style="margin-top:14px">Pick exactly two denominators</h3>
      <div id="choices" class="grid" style="margin-bottom:12px"></div>

      <div style="display:flex;gap:10px">
        <button id="checkBtn" class="btn" disabled>Check Answer</button>
        <button id="resetBtn" class="btn secondary">Reset Selection</button>
        <button id="nextBtn" class="btn secondary" disabled>Next ‚ñ∏</button>
      </div>
      <div class="muted" id="helper" style="margin-top:8px">Pick two denominators, then press Check.</div>
    </section>

    <!-- RIGHT -->
    <aside class="right">
      <section class="card coach">
        <h3 class="title">Think-Aloud Coach</h3>
        <div id="coachText" class="muted">
          Starter check-in:
          <ul>
            <li>Is our target a small amount or a big amount?</li>
            <li>Unit fractions get smaller when denominators get bigger.</li>
            <li>Quick estimate: will both denominators likely be bigger than the target‚Äôs denominator, or around it?</li>
          </ul>
        </div>
      </section>
    </aside>
  </div>
</main>

<script>
/* ===== Helpers ===== */
const $ = (id)=>document.getElementById(id);
function drawUnitBar(el, parts, shadeCountLeft=1, shadeCountRight=0){
  el.innerHTML = "";
  if(!parts || parts<1) return;
  const totalShade = Math.min(parts, shadeCountLeft+shadeCountRight);
  for(let i=0;i<parts;i++){
    const d=document.createElement("div");
    d.className="seg";
    if(i<shadeCountLeft){ d.style.background="rgba(37,99,235,.35)"; }
    else if(i<totalShade){ d.style.background="rgba(34,197,94,.35)"; }
    el.appendChild(d);
  }
}
function lcm(a,b){ const g=(x,y)=>y?g(y,x%y):x; return a/g(a,b)*b; }
function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

/* ===== State ===== */
let q=1, score=0;
let targetN = 8;
let pick1 = null, pick2 = null;
let attempts = 0, wrongAttempts = 0;
let allowNext = false;

const DEN_MIN = 2, DEN_MAX = 20;
const TOTAL_QUESTIONS = 10;

const poolEasy = [8,9,10,12]; // target denominators
const poolMedium = [6,7,11,13,14];
const poolHard = [15,16,18,20];
let level = "easy";

/* ===== Core Math ===== */
// Check 1/a + 1/b = 1/n with a ‚â† b
function isCorrect(n,a,b){
  return a!==b && (a*b === n*(a+b));
}

// For a given n, list all denominators in [DEN_MIN..DEN_MAX] that have a valid partner (within range, distinct)
function validDenominatorsFor(n){
  const S = new Set();
  for(let a=DEN_MIN;a<=DEN_MAX;a++){
    if(a===n) continue; // not necessary but fine
    // solve for b: 1/a + 1/b = 1/n -> b = (n*a)/(a-n)
    const denom = a - n;
    if(denom<=0) continue;
    const num = n*a;
    if(num % denom !== 0) continue;
    const b = num/denom;
    if(Number.isInteger(b) && b>=DEN_MIN && b<=DEN_MAX && b!==a){
      S.add(a); S.add(b);
    }
  }
  return [...S];
}

// Find one correct pair (a,b) in-range with a‚â†b
function findPair(n){
  for(let a=DEN_MIN;a<=DEN_MAX;a++){
    const denom = a - n;
    if(denom<=0) continue;
    const num = n*a;
    if(num % denom !== 0) continue;
    const b = num/denom;
    if(Number.isInteger(b) && b>=DEN_MIN && b<=DEN_MAX && b!==a){
      return [a,b];
    }
  }
  return null;
}

// Pick a target n that has at least one distinct solution in-range
function pickTarget(fromPool){
  const tries = shuffle([...fromPool]);
  for(const n of tries){
    if(findPair(n)) return n;
  }
  // Fallback scan across 3..20
  for(let n=3;n<=20;n++){ if(findPair(n)) return n; }
  return 8; // safety
}

/* ===== Rendering ===== */
function render(){
  $("qNo").textContent = q;
  $("score").textContent = score;
  $("attempts").textContent = attempts;

  $("headlineTarget").textContent = `1/${targetN}`;
  $("pillTarget").textContent = `1/${targetN}`;
  $("targetSentence").innerHTML = `Make <b>1/${targetN}</b> using two unit fractions.`;
  $("liveEq").textContent = `1/${targetN} = 1/${pick1 ?? "‚Äì"} + 1/${pick2 ?? "‚Äì"}`;

  drawUnitBar($("barTarget"), targetN, 1, 0);
  $("barPick1").innerHTML = ""; $("barPick2").innerHTML = "";
  if(pick1) drawUnitBar($("barPick1"), pick1, 1, 0);
  if(pick2) drawUnitBar($("barPick2"), pick2, 1, 0);

  // Compare (only when both picked)
  if(pick1 && pick2){
    const L = [pick1,pick2,targetN].reduce((x,y)=>lcm(x,y));
    const tShade = L/targetN, s1=L/pick1, s2=L/pick2;
    drawUnitBar($("cmpTarget"), L, tShade, 0);
    drawUnitBar($("cmpSum"), L, s1, s2);
    $("cmpText").textContent = `Common split: ${L}. Your shaded pieces: ${s1+s2}/${L}. Target shaded pieces: ${tShade}/${L}.`;
  }else{
    $("cmpTarget").innerHTML = ""; $("cmpSum").innerHTML = "";
    $("cmpText").textContent = "Pick two numbers to compare.";
    $("cmpVerdict").textContent = "";
  }

  // Build choices: 8 unique numbers ONLY from valid denominators for this target
  const valids = validDenominatorsFor(targetN);
  // Ensure we have at least 2
  const [solA, solB] = findPair(targetN) || [null,null];
  const base = new Set();
  if(solA) { base.add(solA); base.add(solB); }
  shuffle(valids).forEach(v=>base.size<8 && base.add(v));
  const list = [...base]; // 2..8 numbers
  const grid = $("choices"); grid.innerHTML = "";
  list.forEach(n=>{
    const b=document.createElement("button");
    b.className="choice";
    b.textContent=n;
    b.setAttribute("aria-label", `Choose denominator ${n}`);
    b.onclick=()=>onChoiceClick(b,n);
    if(n===pick1 || n===pick2) b.classList.add("selected");
    grid.appendChild(b);
  });

  // Buttons
  $("checkBtn").disabled = !(pick1 && pick2);
  $("nextBtn").disabled = !allowNext;

  // Reset reveal each render unless explicitly shown after 5 wrong
  // (keep it as is once revealed)
}

/* ===== Round / Flow ===== */
function newQuestion(nextLevel=level){
  level = nextLevel;
  const pool = level==="hard"?poolHard : level==="medium"?poolMedium : poolEasy;
  targetN = pickTarget(pool);

  pick1 = pick2 = null;
  attempts = wrongAttempts = 0;
  allowNext = false;

  $("cmpVerdict").textContent = "";
  $("revealCard").classList.add("hidden");
  $("helper").textContent = "Pick two denominators, then press Check.";

  $("coachText").innerHTML =
   `Let‚Äôs make <b>1/${targetN}</b>. Pick one number you think might work. Why that one?
    <div class="note" style="margin-top:6px">Tip: try ‚Äúsame-family‚Äù numbers first (linked to ${targetN}), then adjust.</div>`;

  render();
}

function onChoiceClick(btn, n){
  // toggle logic, but max 2 selected; glow handled by CSS class
  const already = (n===pick1 || n===pick2);
  if(already){
    if(n===pick1) pick1=null; else pick2=null;
    btn.classList.remove("selected");
  }else{
    if(pick1 && pick2) return; // limit to two
    if(!pick1) pick1=n; else if(n!==pick1) pick2=n;
    btn.classList.add("selected");
  }
  $("liveEq").textContent = `1/${targetN} = 1/${pick1 ?? "‚Äì"} + 1/${pick2 ?? "‚Äì"}`;
  render();
}

/* ===== Encouragement / Difficulty ===== */
function encouragement(){
  if(wrongAttempts===0 && attempts>0) return `<span class="ok">You nailed it!</span> Let‚Äôs give you something more challenging! üî∫`;
  if(wrongAttempts===3) return `<span class="ok">You're on track!</span> Keep going! ‚û°Ô∏è`;
  if(wrongAttempts>3) return `<span class="no">Hang in there!</span> We'll help you out. üîª`;
  return `Great effort ‚Äî adjust and try again!`;
}
function decideNextLevel(){
  if(wrongAttempts===0) return "hard";
  if(wrongAttempts===3) return level;
  if(wrongAttempts>3) return "easy";
  return level;
}
function revealAnswer(){
  const pair = findPair(targetN);
  if(!pair) return;
  const [a,b]=pair;
  $("revealEq").textContent = `1/${targetN} = 1/${a} + 1/${b}`;
  const L = lcm(a,b);
  const tShade = L/targetN;
  drawUnitBar($("revTarget"), L, tShade, 0);
  drawUnitBar($("revSum"), L, L/a, L/b);
  $("revealCard").classList.remove("hidden");
}

/* ===== Check / Buttons ===== */
$("checkBtn").onclick = ()=>{
  if(!(pick1 && pick2)) return;
  attempts++; $("attempts").textContent = attempts;

  const ok = isCorrect(targetN, pick1, pick2);
  const L = [pick1,pick2,targetN].reduce((x,y)=>lcm(x,y));
  const tShade = L/targetN;
  drawUnitBar($("cmpTarget"), L, tShade, 0);
  drawUnitBar($("cmpSum"), L, L/pick1, L/pick2);

  if(ok){
    score++; $("score").textContent = score;
    $("cmpVerdict").innerHTML = `<span class="emoji">üéØ</span><b>Awesome! Right on target!</b> ${encouragement()}`;
    // Unlock next immediately if solved within 5 tries
    if(attempts<=5){ allowNext = true; $("nextBtn").disabled = false; }
  }else{
    wrongAttempts++;
    const bigger = (1/pick1 + 1/pick2) > (1/targetN);
    $("cmpVerdict").innerHTML =
      `<span class="emoji">ü§î</span><b>Oops! Try again, I know you can do it!</b>
       <div class="note" style="margin-top:4px">
       Our sum is <b>${bigger?"bigger":"smaller"}</b> than 1/${targetN}.
       Next try: use <b>${bigger?"bigger":"smaller"}</b> denominators (${bigger?"that makes each unit fraction smaller":"that makes each unit fraction bigger"}).
       </div>`;
    if(wrongAttempts>=5){ revealAnswer(); }
  }

  // Always unlock after 5 attempts (even if still wrong)
  if(attempts>=5){ allowNext = true; $("nextBtn").disabled = false; }

  $("helper").innerHTML = `Attempts: <b>${attempts}</b>/5. ${encouragement()}`;
};

$("resetBtn").onclick = ()=>{
  pick1 = pick2 = null;
  $("cmpVerdict").textContent = "";
  render();
};

$("nextBtn").onclick = ()=>{
  const nextLevel = decideNextLevel();
  q = Math.min(TOTAL_QUESTIONS, q+1);
  newQuestion(nextLevel);
};

/* ===== Boot ===== */
newQuestion("easy");
</script>
</body>
</html>
