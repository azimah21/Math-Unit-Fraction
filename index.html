<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f6f8fb; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
    --brand:#2563eb; --brand-weak:#e6efff; --ok:#16a34a; --warn:#dc2626;
    --ring:rgba(37,99,235,.35);
  }
  html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  h1{font-size:40px;letter-spacing:.2px;margin:8px 0 2px}
  .sub{color:var(--muted);margin:0 0 20px}
  .row{display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 4px 16px rgba(17,24,39,.07);padding:18px}
  .card-title{font-weight:700;margin:0 0 10px}
  .pill{display:inline-block;background:#eef2ff;color:#3730a3;padding:6px 10px;border-radius:999px;font-size:14px;margin-right:8px}
  .kpis{margin:8px 0 16px}
  .muted{color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{
    padding:14px 16px;border:1px solid #e5e7eb;background:#fff;border-radius:12px;
    font-weight:600;text-align:center;cursor:pointer;user-select:none
  }
  .btn:hover{outline:3px solid var(--brand-weak)}
  .btn.sel{outline:3px solid var(--ring);background:#f8fbff}
  .btn.primary{background:var(--brand);color:#fff;border:none}
  .btn.ghost{background:#eef2ff;color:#111827;border:none}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .note{margin-top:8px;color:var(--muted)}
  .eq{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background:#f7fafc;border:1px solid #e5e7eb;padding:10px 12px;border-radius:10px}
  .eq b{color:#111827}
  .coach li{margin:6px 0}
  .mini{font-size:12px;color:var(--muted)}
  .bar{
    height:18px;border:1px solid #e5e7eb;border-radius:8px;display:flex;overflow:hidden;background:#fff
  }
  .seg{flex:1;border-right:1px solid #e5e7eb}
  .seg:last-child{border-right:none}
  .shade{background:rgba(37,99,235,.22)}
  .vizTitle{font-size:13px;color:var(--muted);margin:4px 0 6px}
  @media (max-width:980px){ .row{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <p class="sub">Let‚Äôs make this fraction: <b id="headlineTarget">1/n</b>. Pick two unit fractions <i>1/a</i> and <i>1/b</i> whose sum equals the target.</p>

    <div class="kpis">
      <span class="pill" id="qPill">Question 1/10</span>
      <span class="pill" id="scorePill">Score 0</span>
      <span class="pill" id="targetPill">Target 1/n</span>
    </div>

    <div class="row">
      <!-- LEFT COLUMN -->
      <div>
        <div class="card">
          <h3 class="card-title">Target</h3>
          <div>Make <b id="niceTarget">1/n</b> using two unit fractions.</div>
          <div style="margin-top:12px">
            <div class="eq" id="eqLine">Equation: <b id="eqShow">1/n = 1/__ + 1/__</b></div>
            <div class="mini" style="margin-top:6px">The right side updates as you choose numbers.</div>
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 class="card-title">Pick exactly two denominators</h3>
          <div class="grid" id="choices"></div>

          <div style="display:flex;gap:10px;margin-top:16px">
            <button class="btn primary" id="checkBtn" disabled>Check Answer</button>
            <button class="btn" id="resetBtn">Reset Selection</button>
            <button class="btn ghost" id="nextBtn" disabled>Next ¬ª</button>
          </div>
          <div class="note" id="hint">Pick two denominators, then press Check.</div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 class="card-title">How it works</h3>
          <p class="muted">
            We want <b>1/a + 1/b = 1/n</b>. That‚Äôs true exactly when
            <b>n(a+b) = ab</b>. For each question the game chooses a target
            denominator <b>n</b>, generates a valid pair <b>(a, b)</b> inside 1‚Äì20,
            mixes in good distractors, and asks you to find the correct pair.
          </p>
          <p class="muted">
            Difficulty adapts to you: a short correct streak moves you up a little;
            a short struggle moves you down. You can tune the ranges near the top of the script.
          </p>
        </div>
      </div>

      <!-- RIGHT COLUMN: COACH -->
      <div class="card coach">
        <h3 class="card-title">Think-Aloud Coach</h3>
        <div id="coachPrompt" class="muted"></div>

        <div style="margin-top:12px">
          <div class="vizTitle">Visuals of your picks</div>

          <div id="viz1" style="display:none;margin-bottom:10px">
            <div class="mini" id="viz1Label"></div>
            <div class="bar" id="bar1"></div>
            <div class="mini" id="viz1Cap" style="margin-top:6px"></div>
          </div>

          <div id="viz2" style="display:none">
            <div class="mini" id="viz2Label"></div>
            <div class="bar" id="bar2"></div>
            <div class="mini" id="viz2Cap" style="margin-top:6px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------------- ADAPTIVE SETTINGS ----------------
   Choices are locked to 1..20. We vary target n to
   feel easier/harder. Tweak these if you like.
---------------------------------------------------- */
const adaptive = {
  level: 1, // 1..3
  streakGood: 0,
  streakBad: 0,
  ranges: { // candidate n by level
    1: [6,7,8,9,10,12],
    2: [7,8,9,10,12,14,15],
    3: [8,9,10,12,14,15,16,18,20]
  }
};

const state = {
  q: 1, totalQ: 10,
  score: 0,
  n: 8,
  answer: {a:null,b:null}, // the true pair
  picks: [], // user choices
  options: [] // numbers shown
};

/* ------------- helpers (fractions) --------------- */
function eq1a1b_1n(a,b,n){
  // exact check using integer arithmetic: n(a+b)=ab
  return n*(a+b) === a*b;
}

function findPairForN(n, limit=20){
  // brute-force search for any pair (a,b) in 1..limit with equality
  for(let a=2;a<=limit;a++){
    for(let b=a;b<=limit;b++){
      if(eq1a1b_1n(a,b,n)) return [a,b];
    }
  }
  return null;
}

function pickNWithPair(){
  // choose n from adaptive range that has a valid pair within 1..20
  const pool = adaptive.ranges[adaptive.level].slice().sort(()=>Math.random()-0.5);
  for(const cand of pool){
    const pair = findPairForN(cand, 20);
    if(pair) return {n:cand, pair};
  }
  // fallback sweep 2..20
  for(let cand=2;cand<=20;cand++){
    const pair = findPairForN(cand, 20);
    if(pair) return {n:cand, pair};
  }
  // should never happen
  return {n:8, pair:[12,24]};
}

function sampleDistinct(exceptSet, count){
  const nums = [];
  while(nums.length<count){
    const x = 1 + Math.floor(Math.random()*20);
    if(!exceptSet.has(x) && !nums.includes(x)) nums.push(x);
  }
  return nums;
}

/* ------------- UI elements --------------- */
const qPill = document.getElementById('qPill');
const scorePill = document.getElementById('scorePill');
const targetPill = document.getElementById('targetPill');
const headlineTarget = document.getElementById('headlineTarget');
const niceTarget = document.getElementById('niceTarget');
const eqShow = document.getElementById('eqShow');
const choicesDiv = document.getElementById('choices');
const checkBtn = document.getElementById('checkBtn');
const resetBtn = document.getElementById('resetBtn');
const nextBtn = document.getElementById('nextBtn');
const hint = document.getElementById('hint');

/* ---- Coach bits ---- */
const coachPrompt = document.getElementById('coachPrompt');
const viz1 = document.getElementById('viz1'), bar1 = document.getElementById('bar1');
const viz2 = document.getElementById('viz2'), bar2 = document.getElementById('bar2');
const viz1Label = document.getElementById('viz1Label'), viz2Label = document.getElementById('viz2Label');
const viz1Cap = document.getElementById('viz1Cap'), viz2Cap = document.getElementById('viz2Cap');

const coach = (() => {
  const starter = (n)=>`
    <ol>
      <li>Our target is <b>1/${n}</b>. Is that a small or a big amount?</li>
      <li>Unit fractions get <b>smaller</b> when denominators get bigger. For <b>1/${n}</b>, will we try a ‚Äúbig + small‚Äù pair or ‚Äúsmall + small‚Äù?</li>
      <li>Quick guess: will both numbers likely be bigger than <b>${n}</b> or around it?</li>
    </ol>
    <div style="margin-top:8px">When you‚Äôre ready: <b>Pick your first number and tell why.</b></div>
  `;

  function setPrompt(html){ coachPrompt.innerHTML = html; }

  function buildBar(el, a){
    el.innerHTML = '';
    for(let i=1;i<=a;i++){
      const d=document.createElement('div');
      d.className='seg'+(i===1?' shade':'');
      el.appendChild(d);
    }
  }

  return {
    start(n){
      setPrompt(starter(n));
      viz1.style.display='none'; viz2.style.display='none';
    },
    onFirstPick(a){
      viz1.style.display='block';
      viz1Label.textContent = `You chose 1/${a}. The bar is split into ${a} equal parts.`;
      buildBar(bar1,a);
      viz1Cap.innerHTML = `You chose <b>1/${a}</b>. The bar shows <b>1/a</b> as one shaded piece.`;
      // prompt next step
      setPrompt(`<b>Nice pick.</b> How will you find the second number?
      <ul>
        <li>Try same-family numbers first (near your first pick or linked to the target).</li>
        <li>If the sum is too big, your numbers were too small. If it‚Äôs too small, your numbers were too big.</li>
      </ul>`);
    },
    onSecondPick(b){
      viz2.style.display='block';
      viz2Label.textContent = `You also chose 1/${b}.`;
      buildBar(bar2,b);
      viz2Cap.innerHTML = `You chose <b>1/${b}</b>.`;
    },
    feedback({correct, sumTooBig, sumTooSmall, n}){
      if(correct){
        setPrompt(`<b class="mini" style="color:var(--ok);font-size:14px">Great! Your pair makes exactly 1/${n}.</b>
        <div style="margin-top:6px">What pattern did you notice? How can you guess faster next time?</div>`);
      }else if(sumTooBig){
        setPrompt(`<div><b>Our sum is bigger than 1/${n}.</b></div>
        <div class="mini" style="margin-top:6px">Next try: use <b>bigger denominators</b> (that makes each unit fraction smaller).</div>`);
      }else if(sumTooSmall){
        setPrompt(`<div><b>Our sum is smaller than 1/${n}.</b></div>
        <div class="mini" style="margin-top:6px">Next try: use <b>smaller denominators</b> (that makes each unit fraction larger).</div>`);
      }else{
        setPrompt(`<div>Try again with the hints above.</div>`);
      }
    }
  };
})();

/* ------------- render & flow --------------- */
function renderEq(){
  const n = state.n;
  const [a,b] = state.picks;
  const left = `1/${n}`;
  const r1 = a ? `1/${a}` : '1/__';
  const r2 = b ? `1/${b}` : '1/__';
  eqShow.innerHTML = `<b>${left} = ${r1} + ${r2}</b>`;
}

function renderChoices(){
  choicesDiv.innerHTML='';
  state.options.forEach(v=>{
    const b=document.createElement('button');
    b.className='btn';
    b.textContent=v;
    b.addEventListener('click',()=>{
      const idx = state.picks.indexOf(v);
      if(idx>=0){ // unselect
        state.picks.splice(idx,1);
        b.classList.remove('sel');
        // hide/clear visuals accordingly
        if(state.picks.length===0){ viz1.style.display='none'; viz2.style.display='none'; }
        if(state.picks.length===1){ viz2.style.display='none'; }
      }else{
        if(state.picks.length===2) return; // cap at 2
        state.picks.push(v);
        b.classList.add('sel');
        if(state.picks.length===1) coach.onFirstPick(v);
        if(state.picks.length===2) coach.onSecondPick(v);
      }
      checkBtn.disabled = state.picks.length!==2;
      renderEq();
    });
    choicesDiv.appendChild(b);
  });
}

function newQuestion(){
  // pick n + answer pair
  const {n, pair} = pickNWithPair();
  state.n = n;
  state.answer = {a:pair[0], b:pair[1]};
  state.picks = [];
  // build options (always show 8 numbers, include the true a & b)
  const set = new Set([pair[0], pair[1]]);
  const extras = sampleDistinct(set, 6);
  state.options = Array.from(set).concat(extras).sort((x,y)=>x-y);

  // paint UI
  qPill.textContent = `Question ${state.q}/${state.totalQ}`;
  scorePill.textContent = `Score ${state.score}`;
  targetPill.textContent = `Target 1/${n}`;
  headlineTarget.textContent = `1/${n}`;
  niceTarget.textContent = `1/${n}`;
  coach.start(n);
  renderEq();
  renderChoices();
  // reset buttons/hints
  checkBtn.disabled = true;
  nextBtn.disabled = true;
  document.querySelectorAll('.btn.sel').forEach(x=>x.classList.remove('sel'));
  hint.textContent = 'Pick two denominators, then press Check.';
}

checkBtn.addEventListener('click', ()=>{
  const [a,b] = state.picks;
  const n = state.n;
  const correct = eq1a1b_1n(a,b,n);
  if(correct){ state.score++; hint.innerHTML = `‚úÖ Correct! <b>1/${a} + 1/${b} = 1/${n}</b>`; }
  else{
    const sum = 1/a + 1/b, t = 1/n;
    const sumTooBig = sum > t + 1e-12, sumTooSmall = sum < t - 1e-12;
    hint.innerHTML = `Not yet. Try adjusting your numbers.`;
    coach.feedback({correct, sumTooBig, sumTooSmall, n});
    adaptive.streakBad++; adaptive.streakGood=0;
    nextBtn.disabled = false; // allow moving on if stuck
    return;
  }
  adaptive.streakGood++; adaptive.streakBad=0;
  nextBtn.disabled = false;
  coach.feedback({correct:true, n});
  // gentle adapt
  if(adaptive.streakGood>=3 && adaptive.level<3){ adaptive.level++; adaptive.streakGood=0; }
  if(adaptive.streakBad>=2 && adaptive.level>1){ adaptive.level--; adaptive.streakBad=0; }
});

resetBtn.addEventListener('click', ()=>{
  state.picks = [];
  renderEq();
  document.querySelectorAll('#choices .btn').forEach(b=>b.classList.remove('sel'));
  checkBtn.disabled = true;
  viz1.style.display='none'; viz2.style.display='none';
  coach.start(state.n);
});

nextBtn.addEventListener('click', ()=>{
  if(state.q < state.totalQ){
    state.q++;
    newQuestion();
  }else{
    hint.innerHTML = `üéâ Finished! Final score: <b>${state.score}/${state.totalQ}</b>. Refresh to play again.`;
    checkBtn.disabled = true; nextBtn.disabled = true;
  }
});

// boot
newQuestion();
</script>
</body>
</html>
