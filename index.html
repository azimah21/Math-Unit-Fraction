<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7f9fc; --card:#ffffff; --ink:#0f172a; --muted:#475569;
    --accent:#2563eb; --accent-2:#22c55e; --warn:#ef4444; --soft:#e2e8f0;
  }
  *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--ink)}
  header{padding:20px 16px 6px;max-width:980px;margin:auto}
  h1{margin:0 0 4px;font-size:32px}
  .sub{color:var(--muted)}
  main{max-width:980px;margin:8px auto 64px;padding:0 16px}
  .row{display:grid;grid-template-columns:1fr 340px;gap:16px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 2px 10px rgba(2,6,23,.06);padding:16px}
  .title{font-weight:700;margin:0 0 10px}
  .pill{display:inline-block;background:#edf2ff;border:1px solid #c7d2fe;border-radius:999px;padding:6px 10px;margin:0 8px 8px 0;font-size:14px}
  .meta{display:flex;gap:8px;margin:6px 0 14px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .btn{border:0;border-radius:12px;padding:12px 14px;font-weight:700;background:var(--accent);color:white;cursor:pointer}
  .btn.secondary{background:#e5e7eb;color:#111827}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .choice{background:#e7eefb;border:2px solid transparent;border-radius:12px;padding:14px 0;text-align:center;font-weight:700;cursor:pointer;transition:transform .06s, box-shadow .06s, border-color .06s}
  .choice:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(2,6,23,.08)}
  .choice.selected{border-color:var(--accent);background:#eef5ff;box-shadow:0 0 0 4px rgba(37,99,235,.12)}
  .choice.disabled{opacity:.45;cursor:not-allowed}
  .eq{font-family:ui-monospace,Menlo,Consolas,monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:10px;padding:10px 12px}
  .muted{color:var(--muted);font-size:14px}
  .bar{height:16px;border:1px solid #e2e8f0;border-radius:8px;display:flex;overflow:hidden;background:white}
  .bar .seg{flex:1;border-right:1px solid #eef2f7}
  .note{font-size:13px;color:var(--muted);margin-top:6px}
  .ok{color:var(--accent-2);font-weight:700}
  .warn{color:var(--warn);font-weight:700}
  .cmpRow{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center;margin:12px 0}
  .emoji{font-size:18px;margin-right:6px}
  /* celebration effects */
  .cele-wrap{position:relative;padding:18px;border:2px dashed #cbd5e1;border-radius:14px;background:#fff}
  .sparkle,.confetti,.firework{position:absolute;pointer-events:none;opacity:.9}
  @keyframes floatUp{0%{transform:translateY(12px);opacity:0}20%{opacity:.9}100%{transform:translateY(-14px);opacity:0}}
  .sparkle{width:8px;height:8px;background:radial-gradient(circle,#ffd54d,#ff9f1a);border-radius:50%;animation:floatUp 1.2s linear infinite}
  .confetti{width:6px;height:12px;background:#60a5fa;transform:rotate(15deg);animation:floatUp 1.4s linear infinite}
  .confetti.alt{background:#f472b6;transform:rotate(-12deg)}
  .firework{width:2px;height:22px;background:#22c55e;animation:floatUp 1s linear infinite}
  #summary{display:none}
</style>
</head>
<body>
<header>
  <h1>Unit Fraction Builder</h1>
  <div class="sub">Letâ€™s make this fraction: <b id="headlineTarget">1/8</b>. Pick exactly two unit fractions to match the target.</div>
</header>

<main>
  <div class="meta">
    <span class="pill">Question <span id="qNo">1</span>/10</span>
    <span class="pill">Score <span id="score">0</span></span>
    <span class="pill">Target <span id="pillTarget">1/8</span></span>
    <span class="pill">Attempts <span id="attempts">0</span>/5</span>
  </div>

  <div class="row">
    <!-- LEFT -->
    <section class="card">
      <h2 class="title">Target</h2>
      <div class="muted" id="targetSentence">Make <b>1/8</b> using two unit fractions.</div>

      <!-- Live equation -->
      <div class="card" style="margin-top:12px">
        <div class="eq" id="liveEq">1/8 = 1/â€“ + 1/â€“</div>
        <div class="muted">Pick two denominators below. The equation will update.</div>
      </div>

      <!-- Compare box (simple) -->
      <div id="compareCard" class="card" style="margin-top:12px">
        <h3 class="title" style="margin-bottom:6px">Feedback</h3>
        <div class="muted" id="feedback">Pick two numbers, then press <b>Check</b>.</div>
      </div>

      <!-- Reveal after 5 wrong -->
      <div id="revealCard" class="card" style="margin-top:12px;border:1px dashed #cbd5e1; display:none;">
        <h3 class="title">Hereâ€™s one correct way</h3>
        <div class="eq" id="revealEq">1/8 = 1/5 + 1/20</div>
      </div>

      <!-- Choices -->
      <h3 class="title" style="margin-top:14px">Pick exactly two denominators</h3>
      <div id="choices" class="grid" style="margin-bottom:12px"></div>

      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button id="checkBtn" class="btn" disabled>Check Answer</button>
        <button id="resetBtn" class="btn secondary">Reset Selection</button>
        <button id="nextBtn" class="btn secondary" disabled>Next â–¸</button>
      </div>
      <div class="muted" id="helper" style="margin-top:8px">Try, check, and adjust. Youâ€™ve got this!</div>
    </section>

    <!-- RIGHT -->
    <aside class="card">
      <h3 class="title">Think-Aloud Tips</h3>
      <ul class="muted" style="margin:8px 0 0 18px">
        <li>Unit fractions get smaller when denominators get bigger.</li>
        <li>If your sum is too big, pick bigger denominators next.</li>
        <li>If your sum is too small, pick smaller denominators next.</li>
      </ul>
    </aside>
  </div>

  <!-- Summary -->
  <section id="summary" class="card" style="margin-top:18px">
    <h2 class="title">Great effort!</h2>
    <div class="cele-wrap" id="cele">
      <div id="finalMsg" class="muted" style="font-size:16px"></div>
    </div>
    <div style="margin-top:12px">
      <button id="playAgainBtn" class="btn">Play Again</button>
    </div>
  </section>
</main>

<script>
/* ------------------ helpers ------------------ */
const $ = (id)=>document.getElementById(id);

function setFeedback(html, cls=""){
  const el = $("feedback");
  el.innerHTML = cls ? \`<span class="\${cls}">\${html}</span>\` : html;
}

function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

/* Check 1/a + 1/b = 1/n with integers safely: ab = n(a+b) */
function isCorrect(n,a,b){ return a*b === n*(a+b); }

/* Find all distinct (a,b) in [2..20], a<b, that solve 1/a + 1/b = 1/n */
function allPairsFor(n, minD=2, maxD=20){
  const pairs=[];
  for(let a=minD;a<=maxD;a++){
    for(let b=a+1;b<=maxD;b++){
      if(isCorrect(n,a,b)) pairs.push([a,b]);
    }
  }
  return pairs;
}

/* Choose a target n that has at least one valid pair in [2..20] with aâ‰ b */
function pickTarget(minN=3,maxN=16){
  // small range that often yields in-range solutions
  for(let tries=0; tries<100; tries++){
    const n = randInt(minN, maxN);
    const pairs = allPairsFor(n,2,20);
    if(pairs.length>0) return {n, pairs};
  }
  // fallback: deterministic n with known pair (n=8 has 1/5 + 1/20)
  return {n:8, pairs:[[5,20]]};
}

/* Build 8 unique choices: include one correct pair + 6 distractors (all 2..20, no duplicates) */
function buildChoices(correctPair){
  const used = new Set(correctPair);
  const choices = new Set(correctPair);
  while(choices.size<8){
    const x = randInt(2,20);
    if(!used.has(x)) choices.add(x), used.add(x);
  }
  return shuffle([...choices]);
}

/* ------------------ state ------------------ */
const state = {
  q:1, total:10,
  score:0,
  target:8,
  pairs:[], // all valid pairs for this target (a<b)
  solution:[5,20], // one chosen solution for reveal
  choices:[],
  selection:[],
  attempts:0,
  locked:false,
  nextEnabled:false,
  finished:false
};

/* ------------------ rendering ------------------ */
function renderHUD(){
  $("qNo").textContent = state.q;
  $("score").textContent = state.score;
  $("pillTarget").textContent = \`1/\${state.target}\`;
  $("headlineTarget").textContent = \`1/\${state.target}\`;
  $("targetSentence").innerHTML = \`Make <b>1/\${state.target}</b> using two unit fractions.\`;
  $("liveEq").textContent = \`1/\${state.target} = 1/\${state.selection[0] ?? "â€“"} + 1/\${state.selection[1] ?? "â€“"}\`;
  $("attempts").textContent = state.attempts;
}

function renderChoices(){
  const wrap = $("choices");
  wrap.innerHTML = "";
  state.choices.forEach(n=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = n;
    btn.addEventListener("click", ()=>{
      if(state.locked) return;
      // toggle / add up to 2, enforce aâ‰ b
      const idx = state.selection.indexOf(n);
      if(idx>=0){
        state.selection.splice(idx,1);
      }else{
        if(state.selection.length===2) return;
        if(state.selection.length===1 && state.selection[0]===n) return; // prevent a=b
        state.selection.push(n);
      }
      // update UI
      document.querySelectorAll(".choice").forEach(b=>{
        const v = parseInt(b.textContent,10);
        b.classList.toggle("selected", state.selection.includes(v));
      });
      $("checkBtn").disabled = state.selection.length!==2;
      $("liveEq").textContent = \`1/\${state.target} = 1/\${state.selection[0] ?? "â€“"} + 1/\${state.selection[1] ?? "â€“"}\`;
    });
    wrap.appendChild(btn);
  });
}

function lockChoices(){
  document.querySelectorAll(".choice").forEach(b=>{
    b.classList.add("disabled");
  });
}

/* ------------------ flow ------------------ */
function newQuestion(){
  state.locked=false;
  state.nextEnabled=false;
  state.selection=[];
  state.attempts=0;
  $("checkBtn").disabled = true;
  $("nextBtn").disabled = true;
  $("revealCard").style.display = "none";
  setFeedback("Pick two numbers, then press <b>Check</b>.");
  const picked = pickTarget(3,16);
  state.target = picked.n;
  state.pairs = picked.pairs; // all valid in-range, distinct
  state.solution = shuffle(picked.pairs.slice())[0]; // select one for reveal
  // choices = 2 from solution + 6 distractors
  state.choices = buildChoices(state.solution);
  renderHUD();
  renderChoices();
}

function encourage(){
  if(state.attempts===1) return "Great start â€” keep exploring!";
  if(state.attempts===2) return "Nice thinking. Check if your sum is too big or too small.";
  if(state.attempts===3) return "You're getting closer. Try adjusting one number.";
  if(state.attempts===4) return "Almost there! One smart tweak might do it.";
  return "Good perseverance! One last try!";
}

function checkAnswer(){
  if(state.selection.length!==2 || state.locked) return;
  state.attempts++;
  $("attempts").textContent = state.attempts;

  const [a,b] = state.selection.slice().sort((x,y)=>x-y);
  const correct = isCorrect(state.target,a,b);

  if(correct){
    state.score++;
    setFeedback(\`<span class="emoji">ðŸŽ¯</span> <b>Awesome! Right on target!</b> \${state.attempts<=5 ? "You can go to the next question." : ""}\`, "ok");
    state.locked = true;
    lockChoices();
    enableNext();
  }else{
    const bigger = (1/a + 1/b) > (1/state.target);
    setFeedback(
      \`<span class="emoji">ðŸ¤”</span><b>Oops! Try again, you can do this!</b>
       <div class="note">Your sum is <b>\${bigger?"bigger":"smaller"}</b> than 1/\${state.target}. Try \${bigger?"bigger":"smaller"} denominators next.</div>\`,
      "warn"
    );
    if(state.attempts>=5){
      // reveal one correct pair and unlock next
      $("revealEq").textContent = \`1/\${state.target} = 1/\${state.solution[0]} + 1/\${state.solution[1]}\`;
      $("revealCard").style.display = "block";
      state.locked = true;
      lockChoices();
      enableNext();
    }
  }

  $("helper").textContent = encourage();
  // allow early next if correct within 5 attempts
  if(correct && state.attempts<=5) enableNext();
}

function enableNext(){
  state.nextEnabled = true;
  $("nextBtn").disabled = false;
}

function nextQuestion(){
  if(!state.nextEnabled) return;
  if(state.q < state.total){
    state.q++;
    newQuestion();
  }else{
    showSummary();
  }
}

function resetSelection(){
  if(state.locked) return;
  state.selection=[];
  document.querySelectorAll(".choice").forEach(b=>b.classList.remove("selected"));
  $("checkBtn").disabled = true;
  $("liveEq").textContent = \`1/\${state.target} = 1/â€“ + 1/â€“\`;
  setFeedback("Selection cleared. Pick two denominators, then press <b>Check</b>.");
}

/* ------------------ summary ------------------ */
function sprinkle(el, cls, count){
  const rect = el.getBoundingClientRect();
  for(let i=0;i<count;i++){
    const d = document.createElement("div");
    d.className = cls;
    d.style.left = Math.random()* (rect.width-20) + "px";
    d.style.top = Math.random()* (rect.height-20) + "px";
    d.style.animationDelay = (Math.random()*0.8)+"s";
    el.appendChild(d);
  }
}

function showSummary(){
  state.finished = true;
  const correct = state.score;
  const final = $("finalMsg");
  const cele = $("cele");
  cele.innerHTML = ""; // reset effects wrapper

  if(correct<=4){
    final.innerHTML = "âœ¨ <b>good try!</b> Keep practising â€” youâ€™re building great habits.";
    sprinkle(cele,"sparkle",24);
  }else if(correct<=7){
    final.innerHTML = "âœ¨ðŸŽ‰ <b>you did it!</b> Nice progress â€” your strategies are working.";
    sprinkle(cele,"sparkle",24);
    sprinkle(cele,"confetti",20);
    sprinkle(cele,"confetti alt",16);
  }else{
    final.innerHTML = "âœ¨ðŸŽ‰ðŸŽ† <b>well done!</b> Superb thinking and persistence!";
    sprinkle(cele,"sparkle",24);
    sprinkle(cele,"confetti",20);
    sprinkle(cele,"confetti alt",16);
    sprinkle(cele,"firework",14);
  }
  $("summary").style.display = "block";
  window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"});
}

/* ------------------ wire & boot ------------------ */
$("checkBtn").addEventListener("click", checkAnswer);
$("nextBtn").addEventListener("click", nextQuestion);
$("resetBtn").addEventListener("click", resetSelection);
$("playAgainBtn").addEventListener("click", ()=>{
  state.q=1; state.score=0; state.finished=false;
  $("summary").style.display="none";
  newQuestion();
});

newQuestion();
</script>
</body>
</html>
