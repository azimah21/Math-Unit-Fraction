
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --ink:#1f2937;
    --muted:#475569;
    --brand:#2563eb;
    --brand-2:#60a5fa;
    --ok:#16a34a;
    --bad:#dc2626;
    --chip:#e6eefc;
    --shadow:0 6px 22px rgba(31,41,55,.08);
    --radius:16px;
  }
  html,body{height:100%}
  body{
    margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
    color:var(--ink); background:var(--bg); line-height:1.45;
  }
  .wrap{max-width:820px; margin:24px auto 64px; padding:0 16px}
  header{margin-bottom:8px}
  h1{font-size:clamp(26px,4vw,36px); margin:0 0 6px}
  .tagline{color:var(--muted); margin:0 0 18px; font-size:clamp(14px,2.5vw,16.5px)}
  .stats{display:flex; flex-wrap:wrap; gap:10px; margin-bottom:14px}
  .pill{background:var(--card); box-shadow:var(--shadow); border-radius:999px; padding:10px 14px; font-weight:600}
  .card{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); margin:14px 0}
  h2{font-size:18px; margin:0 0 10px}
  .targetBar{
    display:flex; align-items:center; gap:10px;
  }
  .segments{
    flex:1 1 auto;
    display:grid;
    grid-auto-flow:column;
    grid-auto-columns:minmax(16px,1fr);
    gap:6px;
    min-height:18px;
    overflow:visible; /* <- prevents “third bar cut off” on small screens */
  }
  .seg{
    background:#e9edf7; border-radius:8px; height:18px; position:relative;
  }
  .seg.fill{ background:linear-gradient(180deg, var(--brand), var(--brand-2)); }
  .selection{
    display:flex; gap:8px; flex-wrap:wrap; min-height:38px;
  }
  .chip{
    background:var(--chip); border:2px solid var(--brand-2);
    border-radius:999px; padding:6px 10px; font-weight:700;
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(74px,1fr));
    gap:12px; margin-top:6px;
  }
  button{
    appearance:none; border:0; border-radius:12px; padding:12px;
    font-weight:700; cursor:pointer; transition:transform .02s ease, box-shadow .2s ease;
  }
  .btn{
    background:#eef2ff; box-shadow:var(--shadow);
  }
  .btn:hover{transform:translateY(-1px)}
  .btn.selected{outline:3px solid var(--brand); background:#e6f0ff}
  .btn-prim{background:var(--brand); color:#fff}
  .btn-ghost{background:#eef2f7}
  .rowButtons{display:flex; gap:12px; flex-wrap:wrap; margin-top:12px}
  .note{color:var(--muted)}
  .feedback{font-weight:700; margin-top:10px}
  .good{color:var(--ok)} .bad{color:var(--bad)}
  /* small screens padding fix */
  @media (max-width:380px){ .rowButtons{flex-direction:column} }
  /* tiny inline svg */
  .tiny-illustration{display:flex; align-items:center; gap:12px; color:var(--muted)}
  .tiny-illustration svg{width:46px; height:46px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Unit Fraction Builder</h1>
    <p class="tagline">Pick two unit fractions <strong>1/a</strong> and <strong>1/b</strong> that make the target <strong>1/n</strong>. Short wins level you up. Stuck? We’ll ease it.</p>
    <div class="stats">
      <div class="pill" id="qStat">Question 1/10</div>
      <div class="pill" id="sStat">Score: 0</div>
      <div class="pill" id="tStat">Target: 1/—</div>
    </div>
  </header>

  <section class="card">
    <h2>Target</h2>
    <div class="targetBar">
      <div class="segments" id="segBar" aria-hidden="true"></div>
      <div style="min-width:58px;text-align:right" id="targetText">1/—</div>
    </div>
  </section>

  <section class="card">
    <h2>Your Selection</h2>
    <div class="selection" id="selection"></div>
    <div class="note">Pick <strong>exactly two</strong> denominators below.</div>
  </section>

  <section class="card">
    <h2>Pick exactly two denominators</h2>
    <div class="grid" id="choices"></div>
    <div class="rowButtons">
      <button class="btn-prim" id="checkBtn" disabled>Check Answer</button>
      <button class="btn-ghost" id="resetBtn">Reset Selection</button>
      <button class="btn" id="nextBtn" disabled>Next ▶</button>
    </div>
    <div id="feedback" class="feedback"></div>
  </section>

  <section class="card">
    <h2>How it works</h2>
    <div class="tiny-illustration">
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <circle cx="50" cy="50" r="46" fill="#e9edf7" />
        <path d="M50 50 L50 4 A46 46 0 1 1 4 50 Z" fill="#60a5fa"/>
      </svg>
      <p>We want <strong>1/a + 1/b = 1/n</strong>. This is true when <strong>n(a+b) = ab</strong>. For each question we pick a target <em>n</em>, create a correct pair <em>(a,b)</em>, mix in close distractors, and ask you to spot the right two.</p>
    </div>
    <p class="note">Difficulty adapts to you: a short correct streak moves you up a level; a short struggle nudges you down. You can tune this in the code under <strong>ADAPTIVE SETTINGS</strong>.</p>
  </section>
</div>

<script>
/* ========= ADAPTIVE SETTINGS ========= */
const adaptive = {
  enabled: true,
  level: 1, // 1 (easiest) .. 3 (hardest)
  upAfter: 3, // correct in a row to level up
  downAfter: 2 // wrong/struggle in last k to level down
};
/* ranges for n by level */
const levelRanges = {
  1: [4, 9], // n between 4..9
  2: [6, 14],
  3: [10, 24]
};
/* ============== STATE ============== */
let qIndex = 0, totalQs = 10, score = 0;
let current = {}; // {n,a,b,choices}
let pick = []; // selected denominators
let streak = 0;
let recentWrong = 0;

/* ============== HELPERS ============== */
const el = id => document.getElementById(id);
const qStat = el('qStat'), sStat = el('sStat'), tStat = el('tStat');
const segBar = el('segBar'), targetText = el('targetText');
const selection = el('selection'), choices = el('choices');
const checkBtn = el('checkBtn'), resetBtn = el('resetBtn'), nextBtn = el('nextBtn');
const feedback = el('feedback');

function randint(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

/* Pick n by level, then generate a valid (a,b) using divisors of n^2:
   If d | n^2 then (a,b) = (n + d, n + n^2/d) works and gives integers. */
function generatePairByN(n){
  const nsq = n*n;
  const divisors = [];
  for(let d=1; d*d<=nsq; d++){
    if(nsq % d === 0){ divisors.push(d); if(d*d!==nsq) divisors.push(nsq/d); }
  }
  // avoid silly tiny/huge gaps; prefer mid divisors
  const sorted = divisors.sort((x,y)=>Math.abs(x-n)-Math.abs(y-n));
  for(const d of sorted){
    const a = n + d, b = n + (nsq/d);
    if(Number.isInteger(a) && Number.isInteger(b) && a>1 && b>1) {
      return [a,b];
    }
  }
  // fallback (shouldn't happen)
  return [n+1, n*(n+1)];
}

function rangeForLevel(){
  const [lo,hi] = levelRanges[adaptive.level];
  return randint(lo,hi);
}

function makeDistractors(n, a, b){
  const set = new Set([a,b]);
  const arr=[];
  while(arr.length<6){
    // near misses + randoms
    const r = Math.random();
    let d;
    if(r < .5){
      d = randint(Math.max(3, n-3), n+24);
    } else {
      d = randint(3, 40);
    }
    if(!set.has(d)){ set.add(d); arr.push(d); }
  }
  return arr;
}

function drawSegments(n){
  segBar.innerHTML = '';
  const maxSeg = Math.min(n, 20); // keep UX tidy
  for(let i=1;i<=maxSeg;i++){
    const s = document.createElement('div');
    s.className = 'seg' + (i===1 ? ' fill' : '');
    segBar.appendChild(s);
  }
  targetText.textContent = `1/${n}`;
  tStat.textContent = `Target: 1/${n}`;
}

function renderChoices(list){
  choices.innerHTML = '';
  list.forEach(val=>{
    const btn = document.createElement('button');
    btn.className = 'btn';
    btn.textContent = val;
    btn.addEventListener('click', ()=>{
      // toggle
      if(pick.includes(val)){
        pick = pick.filter(x=>x!==val);
        btn.classList.remove('selected');
      } else {
        if(pick.length<2){ pick.push(val); btn.classList.add('selected'); }
      }
      updateSelection();
    });
    choices.appendChild(btn);
  });
}

function updateSelection(){
  selection.innerHTML = '';
  pick.forEach(v=>{
    const c = document.createElement('span');
    c.className = 'chip';
    c.textContent = `1/${v}`;
    selection.appendChild(c);
  });
  checkBtn.disabled = (pick.length!==2);
  nextBtn.disabled = true;
}

function newQuestion(){
  qIndex++;
  qStat.textContent = `Question ${Math.min(qIndex,totalQs)}/${totalQs}`;
  feedback.textContent = '';
  feedback.className = 'feedback';

  const n = rangeForLevel();
  const [a,b] = generatePairByN(n);

  const opts = shuffle([a,b, ...makeDistractors(n,a,b)]).slice(0,8);
  current = { n, a, b, choices: opts };

  drawSegments(n);
  renderChoices(opts);
  pick = [];
  updateSelection();
}

function checkAnswer(){
  const ok = (pick.length===2) &&
             ((pick[0]===current.a && pick[1]===current.b) ||
              (pick[0]===current.b && pick[1]===current.a));
  if(ok){
    score++; sStat.textContent = `Score: ${score}`;
    feedback.textContent = `Nice! 1/${current.a} + 1/${current.b} = 1/${current.n}.`;
    feedback.classList.add('good'); feedback.classList.remove('bad');
    streak++; recentWrong = 0;
  }else{
    feedback.textContent = `Not quite. A correct pair for 1/${current.n} is 1/${current.a} + 1/${current.b}.`;
    feedback.classList.add('bad'); feedback.classList.remove('good');
    streak = 0; recentWrong++;
  }
  // adaptive move
  if(adaptive.enabled){
    if(streak >= adaptive.upAfter && adaptive.level < 3){ adaptive.level++; streak=0; }
    if(recentWrong >= adaptive.downAfter && adaptive.level > 1){ adaptive.level--; recentWrong=0; }
  }
  // enable next
  nextBtn.disabled = false;
  checkBtn.disabled = true;
}

function resetSelection(){
  pick = [];
  document.querySelectorAll('.btn.selected').forEach(b=>b.classList.remove('selected'));
  updateSelection();
}

checkBtn.addEventListener('click', checkAnswer);
resetBtn.addEventListener('click', resetSelection);
nextBtn.addEventListener('click', ()=>{
  if(qIndex < totalQs){ newQuestion(); }
  else{
    feedback.textContent = `Great work! Final score: ${score}/${totalQs}. Tap Reset to play again.`;
    feedback.classList.remove('bad'); feedback.classList.add('good');
  }
  nextBtn.disabled = true;
});

newQuestion();
</script>
</body>
</html>





