<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7fafc; /* very light background */
    --card:#ffffff;
    --text:#111827; /* slate-900 */
    --muted:#5b6472; /* slate-500 */
    --primary:#2563eb; /* blue-600 */
    --primary-ghost:#e8f0fe;
    --ok:#16a34a; /* green-600 */
    --bad:#b91c1c; /* red-700 */
    --border:#e5e7eb;
    --chip:#eef2ff; /* indigo-50 */
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";}

  .wrap{max-width:960px;margin:24px auto;padding:0 16px;}
  h1{font-size:40px;line-height:1.1;margin:0 0 8px;}
  .subtitle{color:var(--muted);margin:0 0 20px;}

  .row{display:flex;gap:16px;align-items:stretch;flex-wrap:wrap;}
  .col{flex:1 1 520px}
  .side{flex:1 1 280px}

  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 3px 12px rgba(0,0,0,.04);padding:16px;}
  .card-title{font-weight:700;margin:0 0 8px;}
  .pillbar{display:flex;gap:10px;margin:8px 0 16px;}
  .pill{background:var(--chip);border-radius:999px;padding:6px 10px;font-size:14px;color:#394150}
  .muted{color:var(--muted);}

  .eq-panel{font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace;background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:12px 14px;font-size:18px;}
  .eq-panel b{font-weight:700}

  /* fraction bars */
  .viz-block{display:flex;flex-direction:column;gap:6px;margin-top:10px}
  .bar{height:18px;border:1px solid var(--border);border-radius:8px;display:flex;overflow:hidden;background:white}
  .seg{flex:1;border-right:1px solid var(--border)}
  .seg:last-child{border-right:none}
  .shade{background:rgba(37,99,235,.25)}

  /* number grid */
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px}
  .btn{
    border:1px solid var(--border);background:white;border-radius:12px;padding:12px 0;
    font-size:18px;cursor:pointer;transition:.1s;
  }
  .btn:hover{background:#f5f7fb}
  .btn.sel{outline:3px solid var(--primary);background:var(--primary-ghost)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .cta{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
  .primary{background:var(--primary);color:#fff;border:none}
  .ghost{background:#eef2f7;border:1px solid var(--border)}
  .hidden{display:none}
  .result{margin-top:10px;font-weight:600}

  @media (max-width:820px){
    .row{flex-direction:column}
    .col,.side{flex:1 1 auto}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <p class="subtitle">Let’s make this fraction: <b id="titleTarget">1/?</b>. Pick two unit fractions <b>1/a</b> and <b>1/b</b> whose sum equals the target.</p>

    <div class="pillbar">
      <span class="pill">Question <span id="qNum">1</span>/10</span>
      <span class="pill">Score <span id="score">0</span></span>
      <span class="pill">Target <span id="pillTarget">1/?</span></span>
    </div>

    <div class="row">
      <div class="col">
        <!-- Target card with live equation + 3 stacked visuals -->
        <div class="card">
          <h3 class="card-title">Target</h3>
          <p class="muted" id="targetText">Make <b>1/n</b> using two unit fractions.</p>

          <div class="eq-panel" id="eqPanel">1/n = 1/_ + 1/_</div>
          <div class="muted" style="margin-top:8px">Pick two denominators below. The equation and bars will update.</div>

          <!-- Visuals (stacked): target bar, then 1st pick, then 2nd pick -->
          <div class="viz-block" id="targetViz">
            <div class="muted"><b>Visual of target</b></div>
            <div id="targetBar" class="bar"></div>
            <div class="muted" id="targetCaption"></div>
          </div>

          <div class="viz-block" id="pick1Viz">
            <div class="muted"><b>Visual of your 1st pick</b></div>
            <div id="pick1Bar" class="bar"></div>
            <div class="muted" id="pick1Caption"></div>
          </div>

          <div class="viz-block" id="pick2Viz">
            <div class="muted"><b>Visual of your 2nd pick</b></div>
            <div id="pick2Bar" class="bar"></div>
            <div class="muted" id="pick2Caption"></div>
          </div>
        </div>

        <!-- Choices -->
        <div class="card" style="margin-top:16px;">
          <h3 class="card-title">Pick exactly two denominators</h3>
          <div class="grid" id="choices"></div>

          <div class="cta">
            <button id="check" class="btn primary" disabled>Check Answer</button>
            <button id="reset" class="btn ghost">Reset Selection</button>
            <button id="next" class="btn ghost hidden">Next ▸</button>
          </div>
          <div id="feedback" class="result"></div>
          <div class="muted" style="margin-top:6px;">Pick two denominators, then press <b>Check</b>.</div>
        </div>

        <!-- How it works -->
        <div class="card" style="margin-top:16px;">
          <h3 class="card-title">How it works</h3>
          <p>We want <b>1/a + 1/b = 1/n</b>. That’s true exactly when <b>n(a+b)=ab</b>. Each question chooses a target <b>n</b>, finds a valid pair <b>(a,b)</b> within 1–20, mixes in friendly distractors, and asks you to find the correct pair.</p>
          <p class="muted">Tip: If your sum is too big, your denominators were too small. If the sum is too small, your denominators were too big.</p>
        </div>
      </div>

      <!-- Right coach panel kept simple & kid-friendly -->
      <div class="side">
        <div class="card">
          <h3 class="card-title">Think-Aloud Coach</h3>
          <div id="coachBox" class="muted">
            1) Is our target a small amount or a big amount?<br/>
            2) Unit fractions get <b>smaller</b> when denominators get bigger.<br/>
            3) Try a “same family” number first (linked to the target), then adjust.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  /* ------------ helpers ------------ */
  const $ = sel => document.querySelector(sel);
  const el = id => document.getElementById(id);

  function renderBar(containerId, denom, shaded = 1){
    const bar = el(containerId);
    bar.innerHTML = "";
    if(!denom || denom < 1){ return; }
    const segCount = Math.max(1, Math.min(denom, 40)); // visual cap safety
    for(let i=1;i<=segCount;i++){
      const d = document.createElement('div');
      d.className = "seg" + (i <= shaded ? " shade" : "");
      bar.appendChild(d);
    }
  }

  function setCaption(id, text){ el(id).textContent = text || ""; }

  function pairsForTarget(n, lo=2, hi=20){
    // Find all integer pairs a,b in [lo,hi] with 1/a + 1/b = 1/n
    // n(a+b)=ab → ab - na - nb = 0 → (a-n)(b-n)=n^2
    const res=[];
    for(let a=lo;a<=hi;a++){
      for(let b=a;b<=hi;b++){
        if (Math.abs( (a*b) - n*(a+b) ) === 0){
          res.push([a,b]);
        }
      }
    }
    return res;
  }

  function pickTargetWithPair(){
    // pick n so that a valid pair within 2..20 exists
    const candidates=[];
    for(let n=3;n<=12;n++){ // nice P4–P5 range
      const ps = pairsForTarget(n,2,20);
      if(ps.length){ candidates.push({n,ps}); }
    }
    const choice = candidates[Math.floor(Math.random()*candidates.length)];
    const pair = choice.ps[Math.floor(Math.random()*choice.ps.length)];
    return { n: choice.n, pair };
  }

  function makeOptions(pair, n){
    // Build 8 buttons from 1..20 (min 2) that include the correct pair.
    const pool = [];
    for(let x=2;x<=20;x++) pool.push(x);

    // remove duplicates so we don't spam the same number
    const set = new Set([pair[0], pair[1]]);
    // add distractors: neighbors and factors of n where possible
    const friendly = [n, 2*n, 3*n/2, 4, 6, 8, 10].map(v=>Math.round(v))
          .filter(v=>v>=2 && v<=20);
    friendly.forEach(v=>set.add(v));
    while(set.size < 8){ set.add(pool[Math.floor(Math.random()*pool.length)]); }

    // shuffle for display
    const arr = Array.from(set);
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr.slice(0,8);
  }

  /* ------------ game state ------------ */
  let q=1, score=0, targetN=8, correctPair=[5,20];
  let picks=[]; // selected denominators (length 0..2)

  function updateHeader(){
    el('qNum').textContent = q;
    el('score').textContent = score;
    el('titleTarget').textContent = `1/${targetN}`;
    el('pillTarget').textContent = `1/${targetN}`;
    el('targetText').innerHTML = `Make <b>1/${targetN}</b> using two unit fractions.`;
  }

  function updateEquation(){
    const [a,b] = picks;
    const left = `1/${targetN}`;
    const rightA = a ? `1/${a}` : `1/_`;
    const rightB = b ? `1/${b}` : `1/_`;
    el('eqPanel').innerHTML = `${left} = ${rightA} + ${rightB}`;
  }

  function updateVisuals(){
    // Target visual
    renderBar('targetBar', targetN, 1);
    setCaption('targetCaption', `Target is 1/${targetN}. The bar is split into ${targetN} equal parts; one part is shaded.`);

    // 1st pick
    const a = picks[0];
    renderBar('pick1Bar', a || 0, a ? 1 : 0);
    setCaption('pick1Caption', a ? `You chose 1/${a}. The bar is split into ${a} equal parts; one part is shaded.` : "");

    // 2nd pick
    const b = picks[1];
    renderBar('pick2Bar', b || 0, b ? 1 : 0);
    setCaption('pick2Caption', b ? `You chose 1/${b}. The bar is split into ${b} equal parts; one part is shaded.` : "");
  }

  function drawChoices(options){
    const box = el('choices');
    box.innerHTML = "";
    options.forEach(v=>{
      const btn = document.createElement('button');
      btn.className = 'btn';
      btn.textContent = v;
      btn.dataset.val = v;
      btn.onclick = () => togglePick(v, btn);
      box.appendChild(btn);
    });
    refreshSelectedButtons();
  }

  function refreshSelectedButtons(){
    document.querySelectorAll('#choices .btn').forEach(b=>{
      const v = Number(b.dataset.val);
      b.classList.toggle('sel', picks.includes(v));
    });
    el('check').disabled = picks.length !== 2;
  }

  function togglePick(v, btn){
    const i = picks.indexOf(v);
    if(i>=0){
      picks.splice(i,1);
    }else{
      if(picks.length<2) picks.push(v);
      else{ picks[1]=v; } // replace the second pick for convenience
    }
    updateEquation(); updateVisuals(); refreshSelectedButtons();
  }

  function newQuestion(){
    picks = [];
    const pick = pickTargetWithPair();
    targetN = pick.n; correctPair = pick.pair.sort((a,b)=>a-b);
    updateHeader(); updateEquation(); updateVisuals();

    // build options and ensure both correct numbers present
    const opts = makeOptions(correctPair, targetN);
    if(!opts.includes(correctPair[0])) opts[0]=correctPair[0];
    if(!opts.includes(correctPair[1])) opts[1]=correctPair[1];
    drawChoices(opts);
    el('feedback').textContent = "";
    el('next').classList.add('hidden');
    el('check').disabled = true;
  }

  function checkAnswer(){
    const [a,b] = picks.slice().sort((x,y)=>x-y);
    const sum = 1/a + 1/b;
    const tgt = 1/targetN;
    const epsilon = 1e-12;

    const correct = Math.abs(sum - tgt) < epsilon;
    const fb = el('feedback');
    if(correct){
      score += 1;
      fb.style.color = "var(--ok)";
      fb.textContent = `Great! ${formatEq(a,b)} is exactly 1/${targetN}.`;
      el('next').classList.remove('hidden');
    }else{
      fb.style.color = "var(--bad)";
      const hint = sum > tgt ? "Sum too big → choose bigger denominators." :
                                "Sum too small → choose smaller denominators.";
      fb.textContent = `Not yet. ${formatEq(a,b)} ≠ 1/${targetN}. ${hint}`;
    }
    el('score').textContent = score;
  }

  function formatEq(a,b){ return `1/${a} + 1/${b}`; }

  el('check').onclick = checkAnswer;
  el('reset').onclick = ()=>{ picks=[]; updateEquation(); updateVisuals(); refreshSelectedButtons(); el('feedback').textContent=""; };
  el('next').onclick = ()=>{ q+=1; newQuestion(); };

  // init
  newQuestion();
})();
</script>
</body>
</html>

