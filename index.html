<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f7fafc; /* light background */
    --card:#ffffff;
    --ink:#1f2937;
    --muted:#6b7280;
    --brand:#2563eb;
    --brand-ghost:#e5edff;
    --ok:#16a34a;
    --warn:#b45309;
    --oops:#dc2626;
    --chip:#eef2ff;
    --outline:#e5e7eb;
    --shadow:0 6px 16px rgba(31,41,55,.06);
    --radius:14px;
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";line-height:1.5}
  .wrap{max-width:1100px;margin:auto;padding:24px}
  h1{margin:0 0 4px;font-size:clamp(26px,3.6vw,44px)}
  .subtitle{color:var(--muted);margin-bottom:18px}
  .row{display:grid;grid-template-columns:1fr;gap:18px}
  @media(min-width:960px){ .row{grid-template-columns:1.2fr .8fr} }
  .card{background:var(--card);border:1px solid var(--outline);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
  .card h2{margin:0 0 10px;font-size:20px}
  .chipset{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 14px}
  .chip{background:var(--chip);border:1px solid var(--outline);color:#111827;border-radius:999px;padding:6px 10px;font-size:13px}
  .badge{display:inline-block;background:#eef2ff;border:1px solid #dbe7ff;color:#334155;padding:4px 10px;border-radius:999px;font-size:12px}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:8px}
  @media(max-width:520px){ .grid{grid-template-columns:repeat(2,1fr)} }
  .btnDen{height:46px;border:1.5px solid var(--outline);border-radius:12px;background:#fff;font-size:18px;cursor:pointer}
  .btnDen:focus{outline:3px solid var(--brand-ghost)}
  .btnDen.active{border-color:var(--brand);box-shadow:0 0 0 3px var(--brand-ghost)}
  .controls{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
  .btn{border:0;border-radius:12px;padding:10px 16px;font-weight:600;cursor:pointer}
  .primary{background:var(--brand);color:#fff}
  .ghost{background:#f1f5f9}
  .next{opacity:.45;pointer-events:none}
  .next.ready{opacity:1;pointer-events:auto}
  .note{color:var(--muted);font-size:14px}
  .feedback{margin-top:10px;font-weight:600}
  .ok{color:var(--ok)} .oops{color:var(--oops)} .warn{color:var(--warn)}
  .eq{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#f8fafc;border:1px dashed var(--outline);border-radius:12px;padding:10px 12px}
  .bars{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px}
  @media(min-width:520px){ .bars{grid-template-columns:1fr 1fr} }
  .barWrap{background:#f8fafc;border:1px solid var(--outline);border-radius:12px;padding:10px}
  .barTitle{font-size:13px;color:var(--muted);margin-bottom:6px}
  .bar{height:18px;border:1px solid var(--outline);border-radius:8px;display:flex;overflow:hidden}
  .seg{flex:1;border-right:1px solid #e5e7eb;background:#fff}
  .seg.shade{background:rgba(37,99,235,.20)}
  .helper{font-size:12px;color:var(--muted);margin-top:6px}
  .coachTitle{font-size:18px;margin:0 0 6px}
  .coach ul{margin:6px 0 0 20px;padding:0}
  .coach li{margin:6px 0}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Unit Fraction Builder</h1>
    <div class="subtitle">Let’s make this fraction: <b id="titleTarget">1/?</b>. Pick two unit fractions <i>1/a</i> and <i>1/b</i> whose sum equals the target.</div>

    <div class="chipset">
      <span class="chip" id="qBadge">Question 1/10</span>
      <span class="chip" id="scoreBadge">Score 0</span>
      <span class="chip" id="targetBadge">Target 1/?</span>
    </div>

    <div class="row">
      <!-- LEFT: game -->
      <section class="card">
        <h2>Target</h2>
        <div class="note" id="targetText">Make <b>1/?</b> using two unit fractions.</div>

        <!-- Live equation panel -->
        <div class="card" style="margin-top:12px">
          <div class="eq" id="eqPanel">1/<span id="eqN">?</span> = 1/<span id="eqA">?</span> + 1/<span id="eqB">?</span></div>
          <div class="helper" id="eqHelp">Pick two denominators below. The equation will update.</div>
        </div>

        <!-- Visual bars for both picks -->
        <div class="bars">
          <div class="barWrap">
            <div class="barTitle">Visual of your 1st pick</div>
            <div class="bar" id="barA"></div>
            <div class="helper" id="barAText">No pick yet.</div>
          </div>
          <div class="barWrap">
            <div class="barTitle">Visual of your 2nd pick</div>
            <div class="bar" id="barB"></div>
            <div class="helper" id="barBText">No pick yet.</div>
          </div>
        </div>

        <!-- Choices -->
        <div class="card" style="margin-top:12px">
          <h2 style="margin-bottom:8px">Pick exactly two denominators</h2>
          <div class="grid" id="choices"></div>

          <div class="controls">
            <button class="btn primary" id="checkBtn">Check Answer</button>
            <button class="btn ghost" id="resetBtn">Reset Selection</button>
            <button class="btn ghost next" id="nextBtn">Next ▸</button>
          </div>
          <div class="note" id="hint">Pick two denominators, then press Check.</div>
          <div class="feedback" id="feedback"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h2>How it works</h2>
          <div class="note">
            We want <b>1/a + 1/b = 1/n</b>. That’s true exactly when
            <b>n(a + b) = ab</b>. For each question the game chooses a target
            denominator <i>n</i>, generates a valid pair <i>(a,b)</i>, mixes in good
            distractors, and asks you to find the correct pair. <br><br>
            Difficulty adapts to you: a short correct streak moves you up a
            level; a short struggle moves you down. You can tune the ranges in
            the code section marked “ADAPTIVE SETTINGS”.
          </div>
        </div>
      </section>

      <!-- RIGHT: coach -->
      <aside class="card coach">
        <h3 class="coachTitle">Think-Aloud Coach</h3>
        <div id="coachPrompt" class="note">
          <!-- filled by JS -->
        </div>
      </aside>
    </div>
  </div>

<script>
/* ===================== ADAPTIVE SETTINGS ===================== */
const adaptive = {
  enabled: true,
  level: 1, // 1 easy, 2 medium, 3 hard
  correctStreak: 0,
  struggle: 0,
  ranges: {
    1: { n:[7,12], den:[8,24] }, // easy
    2: { n:[10,18], den:[9,35] }, // medium
    3: { n:[12,24], den:[10,40] }, // hard
  }
};

/* ===================== STATE ===================== */
let qIndex = 1, score = 0, totalQ = 10;
let n, pairA, pairB, options = [];
let pickA = null, pickB = null;

/* ===================== UTIL ===================== */
function randInt(lo, hi){ return Math.floor(Math.random()*(hi-lo+1))+lo; }
function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function factors(num){
  const out=[]; const r=Math.floor(Math.sqrt(num));
  for(let d=1; d<=r; d++){
    if(num%d===0){ out.push(d); if(d*d!==num) out.push(num/d); }
  }
  return out.sort((a,b)=>a-b);
}
function makeValidPairFor(n){
  // Using (a-n)(b-n)=n^2 -> choose a factor d of n^2
  const fac = factors(n*n);
  // try several times to get a,b in current level range
  for(let tries=0; tries<80; tries++){
    const d = choice(fac);
    const a = n + d;
    const b = n + Math.floor((n*n)/d);
    let lo = adaptive.ranges[adaptive.level].den[0];
    let hi = adaptive.ranges[adaptive.level].den[1];
    if(a>=lo && a<=hi && b>=lo && b<=hi && a!==b){
      return a<b ? [a,b] : [b,a];
    }
  }
  // fallback: just return something
  const d = choice(fac);
  return [n+d, n+Math.floor((n*n)/d)].sort((x,y)=>x-y);
}
function generateTarget(){
  const r = adaptive.ranges[adaptive.level];
  n = randInt(r.n[0], r.n[1]);
  // small tweak: avoid too tiny/huge bars
  if(n<3) n=3;
  return n;
}
function buildOptions(correctA, correctB){
  const r = adaptive.ranges[adaptive.level];
  const lo=r.den[0], hi=r.den[1];
  const set = new Set([correctA, correctB]);
  // friendly distractors near n, multiples, primes
  while(set.size<8){
    const pick = Math.max(lo, Math.min(hi,
      [n-1,n+1,2*n,3*n,correctA+1,correctB-1,randInt(lo,hi)][randInt(0,6)]
    ));
    set.add(pick);
  }
  return Array.from(set).sort((a,b)=>a-b);
}
function renderBadges(){
  document.getElementById('qBadge').textContent = `Question ${qIndex}/${totalQ}`;
  document.getElementById('scoreBadge').textContent = `Score ${score}`;
  document.getElementById('targetBadge').textContent = `Target 1/${n}`;
  document.getElementById('titleTarget').textContent = `1/${n}`;
  document.getElementById('targetText').innerHTML = `Make <b>1/${n}</b> using two unit fractions.`;
  // equation panel target
  document.getElementById('eqN').textContent = n;
}
function clearPicks(){
  pickA = pickB = null;
  document.querySelectorAll('.btnDen').forEach(b=>b.classList.remove('active'));
  updateEquation();
  drawBar('barA', 0, 'barAText');
  drawBar('barB', 0, 'barBText');
  setHint('Pick two denominators, then press Check.');
  setFeedback('');
  setNext(false);
}
function drawBar(elId, denom, labelId){
  const bar = document.getElementById(elId);
  bar.innerHTML = '';
  const label = document.getElementById(labelId);
  if(!denom || denom<1){ label.textContent = 'No pick yet.'; return; }
  const maxSeg = Math.min(denom, 40); // keep it sane
  for(let i=1;i<=maxSeg;i++){
    const seg = document.createElement('div');
    seg.className='seg'+(i===1?' shade':'');
    bar.appendChild(seg);
  }
  label.textContent = `You chose 1/${denom}. The bar is split into ${denom} equal parts; one part is shaded.`;
}
function updateEquation(){
  document.getElementById('eqA').textContent = pickA ?? '…';
  document.getElementById('eqB').textContent = pickB ?? '…';
}

/* ===================== COACH ===================== */
const coach = (() => {
  const box = () => document.getElementById('coachPrompt');
  const set = html => box().innerHTML = html;

  function starter(){
    set(`<div><b>Starter check-in (before you try):</b>
      <ul>
        <li>Our target is <b>1/${n}</b>. Is this a small amount or a big amount?</li>
        <li>Unit fractions get <b>smaller</b> when denominators get <b>bigger</b>.
            So do you expect a “big+small” pair or “small+small”?</li>
        <li>Quick estimate: will both denominators likely be bigger than ${n} or around it?</li>
      </ul>
      <div style="margin-top:8px"><b>Your first move:</b> Pick <b>one</b> denominator you think might work. Why that one?</div>
    </div>`);
  }

  function afterFirstPick(a){
    set(`<div><b>Nice pick.</b> How will you find the second number?
      <ul>
        <li>Try same-family numbers first (near your first pick or linked to the target).</li>
        <li>If the sum is <b>too big</b>, your numbers were <b>too small</b>.
            If it’s <b>too small</b>, your numbers were <b>too big</b>.</li>
      </ul>
      <div style="margin-top:6px">Visual of your pick shown on the left.</div>
    </div>`);
  }

  function onCheck({correct, sumTooBig, sumTooSmall}){
    if(correct){
      set(`<div class="ok"><b>Great!</b> What pattern did you notice about denominators that worked?
      How could you guess faster next time using that pattern?</div>`);
      return;
    }
    if(sumTooBig){
      set(`<div class="warn">Our sum is <b>bigger</b> than 1/${n}. Next time, try <b>bigger</b> denominators. Which one will you change first, and why?</div>`);
    }else if(sumTooSmall){
      set(`<div class="warn">Our sum is <b>smaller</b> than 1/${n}. Next time, try <b>smaller</b> denominators. Which one will you change first, and why?</div>`);
    }else{
      set(`<div>Try again: choose two denominators. Use the bar pictures and the equation to help you reason.</div>`);
    }
  }

  return { starter, afterFirstPick, onCheck };
})();

/* ===================== GAME FLOW ===================== */
function newQuestion(){
  generateTarget();
  [pairA, pairB] = makeValidPairFor(n);
  options = buildOptions(pairA, pairB);
  renderChoices();
  renderBadges();
  clearPicks();
  coach.starter();
}
function renderChoices(){
  const grid = document.getElementById('choices');
  grid.innerHTML = '';
  options.forEach(val=>{
    const b = document.createElement('button');
    b.className='btnDen';
    b.textContent = val;
    b.setAttribute('aria-pressed','false');
    b.addEventListener('click', ()=>{
      // toggle/select with max 2
      if(b.classList.contains('active')){
        b.classList.remove('active');
        if(pickA===val) pickA=null;
        else if(pickB===val) pickB=null;
      }else{
        const count = [pickA,pickB].filter(Boolean).length;
        if(count>=2){ return; }
        b.classList.add('active');
        if(pickA===null) { pickA=val; drawBar('barA', pickA, 'barAText'); coach.afterFirstPick(pickA); }
        else { pickB=val; drawBar('barB', pickB, 'barBText'); }
      }
      updateEquation();
    });
    grid.appendChild(b);
  });
}
function setHint(t){ document.getElementById('hint').textContent = t; }
function setFeedback(t, cls=''){ const f=document.getElementById('feedback'); f.className='feedback '+cls; f.textContent=t; }
function setNext(on){ const n=document.getElementById('nextBtn'); n.classList.toggle('ready', !!on); }

document.getElementById('resetBtn').addEventListener('click', ()=> clearPicks());

document.getElementById('checkBtn').addEventListener('click', ()=>{
  if(pickA===null || pickB===null){ setFeedback('Pick two denominators first.', 'warn'); return; }
  const sum = 1/pickA + 1/pickB;
  const target = 1/n;
  const eps = 1e-10;
  const correct = Math.abs(sum - target) < eps;
  const sumTooBig = sum > target + eps;
  const sumTooSmall = sum < target - eps;

  if(correct){
    score++; adaptive.correctStreak++; adaptive.struggle=0;
    setFeedback(`Well done! ${formatEq(pickA, pickB)} = 1/${n}`, 'ok');
    setNext(true);
  }else{
    adaptive.correctStreak=0; adaptive.struggle++;
    const tip = sumTooBig ? 'Your sum is too big — try bigger denominators next time.'
                          : 'Your sum is too small — try smaller denominators next time.';
    setFeedback(`Not quite. ${tip} The correct pair for 1/${n} is 1/${pairA} + 1/${pairB}.`, 'oops');
    setNext(true);
  }
  coach.onCheck({correct, sumTooBig, sumTooSmall});
  tuneLevel();
});

document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(!document.getElementById('nextBtn').classList.contains('ready')) return;
  qIndex++;
  if(qIndex>totalQ){
    alert(`Great effort! Final score: ${score}/${totalQ}. Starting a fresh round.`);
    qIndex=1; score=0; adaptive.level=1; adaptive.correctStreak=0; adaptive.struggle=0;
  }
  newQuestion();
});

function tuneLevel(){
  if(!adaptive.enabled) return;
  if(adaptive.correctStreak>=3 && adaptive.level<3){ adaptive.level++; adaptive.correctStreak=0; }
  if(adaptive.struggle>=2 && adaptive.level>1){ adaptive.level--; adaptive.struggle=0; }
}

function formatEq(a,b){ return `1/${a} + 1/${b}`; }

/* init */
newQuestion();
</script>
</body>
</html>
