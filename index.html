<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Unit Fraction Builder</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --ink:#0f172a;
    --muted:#475569;
    --ring:#dbe9ff;
    --accent:#2563eb;
    --accent-ghost: rgba(37,99,235,.18);
    --border:#e5e7eb;
    --chip:#eef2ff;
    --chip-ink:#334155;
    --bad:#b91c1c;
    --good:#047857;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color:var(--ink); background:var(--bg);
  }
  header{padding:24px 16px 8px; max-width:980px; margin:0 auto}
  h1{margin:0 0 6px; font-size: clamp(28px, 3.6vw, 44px); letter-spacing:.2px}
  .sub{color:var(--muted)}
  main{max-width:980px; margin:12px auto 64px; padding:0 16px; display:grid; gap:16px; grid-template-columns:1fr; }
  @media(min-width:980px){ main{grid-template-columns: 1.1fr .9fr;} }

  .badge{display:inline-block; background:var(--chip); color:var(--chip-ink); padding:6px 10px; border-radius:999px; font-size:13px; margin-right:8px}
  .row{margin-top:10px}

  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 6px 16px rgba(0,0,0,.04)}
  .card h2,.card h3{margin:0 0 10px}
  .muted{color:var(--muted)}
  .eq{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      background:#f8fafc; border:1px solid var(--border); border-radius:12px; padding:12px 14px; font-size:15px}

  .grid{display:grid; grid-template-columns:repeat(4,1fr); gap:14px}
  .btn{
    display:inline-flex; align-items:center; justify-content:center;
    height:48px; padding:0 14px; border-radius:14px; border:1px solid var(--border);
    background:#fff; cursor:pointer; font-size:16px;
    transition: box-shadow .15s, transform .02s, border-color .15s;
  }
  .btn:hover{box-shadow:0 6px 16px rgba(0,0,0,.05)}
  .btn:active{transform: translateY(1px)}
  .btn.selected{border-color:var(--accent); box-shadow:0 0 0 3px var(--ring); background: #f7fbff}
  .btn.primary{background:var(--accent); color:#fff; border-color:transparent}
  .btn.ghost{background:#fff}
  .bar{
    height:16px; border:1px solid var(--border); border-radius:10px;
    display:flex; overflow:hidden; background:#fff;
  }
  .seg{flex:1; border-right:1px solid var(--border); background:#fff}
  .seg:last-child{border-right:none}
  .seg.fill{background:var(--accent-ghost)}
  .tiny{font-size:12px; color:var(--muted)}
  .coach .dot{width:8px;height:8px;border-radius:50%; background:var(--accent); display:inline-block;margin-right:8px}
  .coach .tip{margin:8px 0 0; font-size:14px; color:var(--muted)}
  .good{color:var(--good)} .bad{color:var(--bad)}
  .disabled{opacity:.6; pointer-events:none}
</style>
</head>
<body>
<header>
  <h1>Unit Fraction Builder</h1>
  <div class="sub">Let’s make this fraction: <b id="headlineTarget">1/—</b>.
    Pick two unit fractions <i>1/a</i> and <i>1/b</i> whose sum equals the target.</div>
  <div class="row">
    <span class="badge" id="qBadge">Question 1/10</span>
    <span class="badge" id="scoreBadge">Score 0</span>
    <span class="badge" id="tBadge">Target 1/—</span>
  </div>
</header>

<main>
  <!-- LEFT COLUMN -->
  <section class="card">
    <h2>Target</h2>
    <div class="muted" id="targetText">Make <b>1/n</b> using two unit fractions.</div>

    <!-- Equation panel -->
    <div class="card" style="margin-top:12px;">
      <div class="eq"><span id="eqL">1/n</span> = <span id="eqA">1/—</span> + <span id="eqB">1/—</span></div>
      <div class="tiny" style="margin-top:8px;">Pick two denominators below. The equation will update.</div>
    </div>

    <!-- Visuals: target, 1st, 2nd -->
    <div class="card" style="margin-top:12px;">
      <h3 style="margin-bottom:8px;">Visuals</h3>

      <div class="tiny" style="margin-bottom:6px;"><b>Target</b> (<span id="labTarget">1/n</span>)</div>
      <div id="barTarget" class="bar"></div>
      <div class="tiny" id="capTarget" style="margin:8px 0 12px;"></div>

      <div class="tiny" style="margin-bottom:6px;"><b>Visual of your 1st pick</b></div>
      <div id="barPick1" class="bar"></div>
      <div class="tiny" id="capPick1" style="margin:8px 0 12px;"></div>

      <div class="tiny" style="margin-bottom:6px;"><b>Visual of your 2nd pick</b></div>
      <div id="barPick2" class="bar"></div>
      <div class="tiny" id="capPick2" style="margin-top:8px;"></div>
    </div>

    <!-- Compare sums -->
    <div class="card" style="margin-top:12px;">
      <h3 style="margin-bottom:6px;">Compare: Your sum vs Target</h3>
      <div class="tiny" style="margin-bottom:6px;">We shade pieces using a common split so both bars can be compared fairly.</div>

      <div class="tiny"><b>Your sum</b> (<span id="labSum">1/a + 1/b</span>)</div>
      <div id="barSum" class="bar"></div>
      <div class="tiny" id="capSum" style="margin:8px 0 12px;"></div>

      <div class="tiny"><b>Target</b> (<span id="labTarget2">1/n</span>)</div>
      <div id="barTarget2" class="bar"></div>
      <div class="tiny" id="capTarget2" style="margin-top:8px;"></div>
    </div>

    <!-- Choices -->
    <div class="card" style="margin-top:12px;">
      <h3>Pick exactly two denominators</h3>
      <div id="choices" class="grid" style="margin-top:8px;"></div>
      <div style="display:flex; gap:10px; margin-top:14px;">
        <button id="checkBtn" class="btn primary disabled">Check Answer</button>
        <button id="resetBtn" class="btn ghost">Reset Selection</button>
        <button id="nextBtn" class="btn ghost disabled">Next ▸</button>
      </div>
      <div id="hint" class="tiny" style="margin-top:10px;">Pick two denominators, then press <b>Check</b>.</div>
    </div>

    <!-- How it works -->
    <div class="card" style="margin-top:12px;">
      <h3>How it works</h3>
      <p class="muted">We want <b>1/a + 1/b = 1/n</b>. That’s true exactly when <b>n(a+b) = ab</b>.
        For each question the game chooses a target denominator <b>n</b>, makes sure there’s a correct pair
        within 1–20, mixes in friendly distractors, and asks you to find the pair.</p>
      <p class="muted">Difficulty adapts to you: a short correct streak moves you up a level; a short struggle moves you down. (P4–P5 friendly.)</p>
    </div>
  </section>

  <!-- RIGHT COLUMN: Coach -->
  <aside class="card coach">
    <h2>Think-Aloud Coach</h2>
    <div id="coachPrompt" class="tip" style="margin-top:6px"></div>

    <div style="margin-top:16px">
      <div class="tiny"><span class="dot"></span><b>Visuals of your picks</b></div>
      <div id="coachBars" class="tiny" style="margin-top:8px; line-height:1.6"></div>
    </div>

    <div id="resultMsg" style="margin-top:16px; font-weight:600"></div>
  </aside>
</main>

<script>
/* ---------- helpers ---------- */
const $ = sel => document.querySelector(sel);
function gcd(a,b){ while(b){ [a,b]=[b,a%b]; } return a; }
function lcm(a,b){ return a/gcd(a,b)*b; }
function lcm3(a,b,c){ return lcm(lcm(a,b),c); }

function buildBar(container, parts, fillParts){
  container.innerHTML = "";
  for(let i=0;i<parts;i++){
    const d=document.createElement("div");
    d.className = "seg" + (i<fillParts ? " fill":"");
    container.appendChild(d);
  }
}

function capUnit(labelEl, capEl, d){
  labelEl && (labelEl.textContent = `1/${d}`);
  capEl && (capEl.textContent = d
     ? `You chose 1/${d}. The bar is split into ${d} equal parts; one part is shaded.` : "");
}

/* ---------- state ---------- */
let q=1, totalQ=10, score=0;
let level=1; // 1 easy (n 6–8), 2 medium (n 8–9), 3 hard (n 9–10)
let streakGood=0, streakBad=0;

let n; // target denominator
let picks=[]; // [a, b]
let chosenButtons=[]; // to allow picking identical denominators twice

/* ---------- coach ---------- */
const coach = (() => {
  const startMsg = () =>
   `Our target is <b>${frac(n)}</b>. Think: unit fractions get smaller when denominators get bigger.<br/>
    Try a number that “plays nice” with ${n} (like doubles).`;
  function onFirstPick(a){
    $("#coachPrompt").innerHTML =
      `<b>Nice pick.</b> How will you find the second number?
       <ul class="tiny">
         <li>Try a same-family number first (near your first pick or linked to ${n}).</li>
         <li>If the sum is too big, your numbers were too small. If it’s too small, your numbers were too big.</li>
       </ul>`;
  }
  function verdict(sum, target){
    if (Math.abs(sum-target)<1e-12)
      return `<span class="good">Perfect! Your sum matches ${frac(n)}.</span>`;
    if (sum>target)
      return `Our sum is <b>bigger</b> than ${frac(n)}. Next try: use <b>bigger denominators</b> (each unit piece gets smaller).`;
    return `Our sum is <b>smaller</b> than ${frac(n)}. Next try: use <b>smaller denominators</b>.`;
  }
  return { startMsg, onFirstPick, verdict };
})();

function frac(d){ return `1/${d}`; }

/* ---------- question generation ---------- */
// Always guarantee a correct pair within 1–20 using (2n, 2n).
function pickTarget(){
  if(level<=1) n = randInt(6,8);
  else if(level===2) n = randInt(8,9);
  else n = randInt(9,10);
}
function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

function makeChoices(){
  const grid = $("#choices"); grid.innerHTML="";
  const correct = 2*n; // <=20 by construction
  // create 8 buttons from 1..20 with two copies of 'correct' shuffled
  const pool = new Set();
  while(pool.size<6){
    const x = randInt(3,20);
    if(x!==correct) pool.add(x);
  }
  const arr = [...pool, correct, correct];
  arr.sort(()=>Math.random()-.5);
  arr.forEach((v,i)=>{
    const b=document.createElement("button");
    b.className="btn";
    b.textContent = v;
    b.dataset.val = v;
    b.addEventListener("click",()=>togglePick(b));
    grid.appendChild(b);
  });
}

function togglePick(btn){
  const v = Number(btn.dataset.val);
  const idx = chosenButtons.indexOf(btn);

  if(idx>-1){
    // unselect
    chosenButtons.splice(idx,1);
    const indexP = picks.findIndex((x,i)=> x===v && i===idx);
    if(indexP>-1) picks.splice(indexP,1);
    btn.classList.remove("selected");
  } else {
    if(chosenButtons.length===2){
      // do nothing if already two
      return;
    }
    chosenButtons.push(btn);
    picks.push(v);
    btn.classList.add("selected");
  }

  // UI updates
  const [a,b] = [picks[0]||null, picks[1]||null];
  updateEquation(a,b);
  drawUnitBars(a,b);
  drawCompareBars(a,b);
  $("#checkBtn").classList.toggle("disabled", picks.length!==2);

  if(picks.length===1) coach.onFirstPick(a);
  if(picks.length===0) $("#coachPrompt").innerHTML = coach.startMsg();
}

function resetSelection(){
  picks=[]; chosenButtons.forEach(b=>b.classList.remove("selected")); chosenButtons=[];
  updateEquation(null,null); drawUnitBars(null,null); drawCompareBars(null,null);
  $("#checkBtn").classList.add("disabled");
  $("#resultMsg").textContent="";
  $("#hint").textContent = "Pick two denominators, then press Check.";
}

/* ---------- bars & equation ---------- */
function updateEquation(a,b){
  $("#eqL").textContent = `1/${n}`;
  $("#eqA").textContent = a?`1/${a}`:"1/—";
  $("#eqB").textContent = b?`1/${b}`:"1/—";
}

function drawTargetBars(){
  buildBar($("#barTarget"), n, 1);
  $("#capTarget").textContent = `Target is 1/${n}. The bar is split into ${n} equal parts; one part is shaded.`;
  buildBar($("#barTarget2"), n, 1);
  $("#capTarget2").textContent = `Target bar again for comparison: 1/${n}.`;
  $("#labTarget").textContent = `1/${n}`;
  $("#labTarget2").textContent = `1/${n}`;
  $("#headlineTarget").textContent = `1/${n}`;
  $("#tBadge").textContent = `Target 1/${n}`;
  $("#targetText").innerHTML = `Make <b>1/${n}</b> using two unit fractions.`;
}

function drawUnitBars(a,b){
  // first pick
  if(a){
    buildBar($("#barPick1"), a, 1);
    $("#capPick1").textContent = `You chose 1/${a}. The bar is split into ${a} equal parts; one part is shaded.`;
  } else {
    $("#barPick1").innerHTML=""; $("#capPick1").textContent="";
  }
  // second pick
  if(b){
    buildBar($("#barPick2"), b, 1);
    $("#capPick2").textContent = `You also chose 1/${b}. The bar is split into ${b} equal parts; one part is shaded.`;
  } else {
    $("#barPick2").innerHTML=""; $("#capPick2").textContent="";
  }

  // coach mini text bars
  const coachBars = [];
  if(a) coachBars.push(`You chose <b>1/${a}</b>.`);
  if(b) coachBars.push(`You also chose <b>1/${b}</b>.`);
  $("#coachBars").innerHTML = coachBars.join("<br/>");
}

function drawCompareBars(a,b){
  const sumLab = (a&&b)?`1/${a} + 1/${b}`:"1/a + 1/b";
  $("#labSum").textContent = sumLab;

  if(a&&b){
    const L = lcm3(a,b,n);
    const sumFill = Math.round(L/a + L/b);
    const targetFill = Math.round(L/n);
    buildBar($("#barSum"), L, sumFill);
    buildBar($("#barTarget2"), L, targetFill);
    $("#capSum").textContent = `Common split: ${L}. Your shaded pieces: ${sumFill}/${L}.`;
    $("#capTarget2").textContent = `Target shaded pieces: ${targetFill}/${L}.`;
  } else {
    $("#barSum").innerHTML=""; $("#capSum").textContent="";
    drawTargetBars(); // ensure target comparison still visible
  }
}

/* ---------- game flow ---------- */
function newQuestion(){
  picks=[]; chosenButtons=[]; $("#resultMsg").textContent="";
  $("#nextBtn").classList.add("disabled");
  $("#checkBtn").classList.add("disabled");
  pickTarget();
  $("#qBadge").textContent = `Question ${q}/${totalQ}`;
  $("#scoreBadge").textContent = `Score ${score}`;
  $("#coachPrompt").innerHTML = coach.startMsg();
  makeChoices();
  resetSelection();
  drawTargetBars();
}
$("#resetBtn").addEventListener("click", resetSelection);

$("#checkBtn").addEventListener("click", ()=>{
  if(picks.length!==2) return;
  const [a,b] = picks;
  const sum = 1/a + 1/b;
  const target = 1/n;
  const ok = Math.abs(sum-target) < 1e-12;
  $("#resultMsg").innerHTML = coach.verdict(sum, target);
  if(ok){ score++; streakGood++; streakBad=0; $("#nextBtn").classList.remove("disabled"); }
  else { streakBad++; streakGood=0; }
  // adapt simple
  if(streakGood>=3 && level<3){ level++; streakGood=0; }
  if(streakBad>=3 && level>1){ level--; streakBad=0; }
  $("#scoreBadge").textContent = `Score ${score}`;
});

$("#nextBtn").addEventListener("click", ()=>{
  if(q<totalQ){ q++; newQuestion(); }
});

/* ---------- boot ---------- */
newQuestion();
</script>
</body>
</html>


